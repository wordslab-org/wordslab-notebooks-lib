<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Anthropic tools study – wordslab-notebooks-lib</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-000f0825b9c55ed21d14970d810c14a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Anthropic tools study – wordslab-notebooks-lib">
<meta property="og:description" content="Python library to help with AI usage in wordslab-notebooks">
<meta property="og:site_name" content="wordslab-notebooks-lib">
<meta name="twitter:title" content="Anthropic tools study – wordslab-notebooks-lib">
<meta name="twitter:description" content="Python library to help with AI usage in wordslab-notebooks">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">wordslab-notebooks-lib</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./tools_study_anthropic.html">Anthropic tools study</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib.core</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./env.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib.env</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib.chat</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib.tools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools_study_answerai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Answerai tools study</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools_study_anthropic.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Anthropic tools study</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools_study_mistral-vibe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mistral vibe 2.0</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib.notebook</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#text-editor-tool" id="toc-text-editor-tool" class="nav-link active" data-scroll-target="#text-editor-tool">Text editor tool</a>
  <ul class="collapse">
  <li><a href="#answerai-text-editor-tools-implementation" id="toc-answerai-text-editor-tools-implementation" class="nav-link" data-scroll-target="#answerai-text-editor-tools-implementation">Answerai Text editor tools implementation</a></li>
  </ul></li>
  <li><a href="#bash-tool" id="toc-bash-tool" class="nav-link" data-scroll-target="#bash-tool">Bash tool</a></li>
  <li><a href="#code-execution-tool" id="toc-code-execution-tool" class="nav-link" data-scroll-target="#code-execution-tool">Code execution tool</a></li>
  <li><a href="#code-interpreter" id="toc-code-interpreter" class="nav-link" data-scroll-target="#code-interpreter">Code interpreter</a></li>
  <li><a href="#web-fetch-tool" id="toc-web-fetch-tool" class="nav-link" data-scroll-target="#web-fetch-tool">Web fetch tool</a>
  <ul class="collapse">
  <li><a href="#answerai-web-fetch-implementation" id="toc-answerai-web-fetch-implementation" class="nav-link" data-scroll-target="#answerai-web-fetch-implementation">Answerai web fetch implementation</a></li>
  <li><a href="#read_url" id="toc-read_url" class="nav-link" data-scroll-target="#read_url">read_url</a></li>
  <li><a href="#scrape_url" id="toc-scrape_url" class="nav-link" data-scroll-target="#scrape_url">scrape_url</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/wordslab-org/wordslab-notebooks-lib/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="tools_study_anthropic.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Anthropic tools study</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div id="a6599c87-ce16-4072-8ceb-7eed4ba03e72" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cloudscraper <span class="im">import</span> create_scraper</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> html2text <span class="im">import</span> HTML2Text</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.parse <span class="im">import</span> urljoin, urlparse</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> textwrap <span class="im">import</span> dedent</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="text-editor-tool" class="level2">
<h2 class="anchored" data-anchor-id="text-editor-tool">Text editor tool</h2>
<p>The model can use an the text editor tool to view and modify text files, helping you debug, fix, and improve your code or other text documents. This allows the model to directly interact with your files, providing hands-on assistance rather than just suggesting changes.</p>
<p><strong>When to use the text editor tool</strong></p>
<p>Some examples of when to use the text editor tool are: - Code debugging: Have the model identify and fix bugs in your code, from syntax errors to logic issues. - Code refactoring: Let the model improve your code structure, readability, and performance through targeted edits. - Documentation generation: Ask the model to add docstrings, comments, or README files to your codebase. - Test creation: Have the model create unit tests for your code based on its understanding of the implementation.</p>
<p><strong>Use the text editor tool</strong></p>
<p>Provide the text editor tool (named <code>str_replace_based_edit_tool</code>) to the model.</p>
<p>You can optionally specify a <code>max_characters</code> parameter to control truncation when viewing large files.</p>
<p>The text editor tool can be used in the following way:</p>
<p>1 Provide the model with the text editor tool and a user prompt</p>
<ul>
<li>Include the text editor tool in your API call</li>
<li>Provide a user prompt that may require examining or modifying files, such as “Can you fix the syntax error in my code?”</li>
</ul>
<p>2 The model uses the tool to examine files or directories</p>
<ul>
<li>The model assesses what it needs to look at and uses the view command to examine file contents or list directory contents</li>
<li>The model response will contain a tool use request with the view command</li>
</ul>
<p>3 Execute the view command and return results</p>
<ul>
<li>Extract the file or directory path from the model’s tool use request</li>
<li>Read the file’s contents or list the directory contents</li>
<li>If a max_characters parameter was specified in the tool configuration, truncate the file contents to that length</li>
<li>Return the results to the model by continuing the conversation with a new user message containing a tool result</li>
</ul>
<p>4 The model uses the tool to modify files</p>
<ul>
<li>After examining the file or directory, the model may use a command such as str_replace to make changes or insert to add text at a specific line number.</li>
<li>If the model uses the str_replace command, it constructs a properly formatted tool use request with the old text and new text to replace it with</li>
</ul>
<p>5 Execute the edit and return results</p>
<ul>
<li>Extract the file path, old text, and new text from the model’s tool use request</li>
<li>Perform the text replacement in the file</li>
<li>Return the results to the model</li>
</ul>
<p>6 The model provides its analysis and explanation</p>
<ul>
<li>After examining and possibly editing the files, the model provides a complete explanation of what it found and what changes it made</li>
</ul>
<p><strong>Text editor tool commands</strong></p>
<p>The text editor tool supports several commands for viewing and modifying files:</p>
<p><strong>view</strong></p>
<p>The <code>view</code> command allows the model to examine the contents of a file or list the contents of a directory. It can read the entire file or a specific range of lines.</p>
<p>Parameters: - command: Must be “view” - path: The path to the file or directory to view - view_range (optional): An array of two integers specifying the start and end line numbers to view. Line numbers are 1-indexed, and -1 for the end line means read to the end of the file. This parameter only applies when viewing files, not directories.</p>
<p>Example view commands</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="er">//</span> <span class="er">Example</span> <span class="er">for</span> <span class="er">viewing</span> <span class="er">a</span> <span class="er">file</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"input"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"command"</span><span class="fu">:</span> <span class="st">"view"</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"path"</span><span class="fu">:</span> <span class="st">"primes.py"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="er">//</span> <span class="er">Example</span> <span class="er">for</span> <span class="er">viewing</span> <span class="er">a</span> <span class="er">directory</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"input"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"command"</span><span class="fu">:</span> <span class="st">"view"</span><span class="fu">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"path"</span><span class="fu">:</span> <span class="st">"src/"</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>str_replace</strong></p>
<p>The <code>str_replace</code> command allows the model to replace a specific string in a file with a new string. This is used for making precise edits.</p>
<p>Parameters: - command: Must be “str_replace” - path: The path to the file to modify - old_str: The text to replace (must match exactly, including whitespace and indentation) - new_str: The new text to insert in place of the old text</p>
<p>Example str_replace command</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"input"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"command"</span><span class="fu">:</span> <span class="st">"str_replace"</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"path"</span><span class="fu">:</span> <span class="st">"primes.py"</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"old_str"</span><span class="fu">:</span> <span class="st">"for num in range(2, limit + 1)"</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"new_str"</span><span class="fu">:</span> <span class="st">"for num in range(2, limit + 1):"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>create</strong></p>
<p>The <code>create</code> command allows the model to create a new file with specified content.</p>
<p>Parameters: - command: Must be “create” - path: The path where the new file should be created - file_text: The content to write to the new file</p>
<p>Example create command</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"input"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"command"</span><span class="fu">:</span> <span class="st">"create"</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"path"</span><span class="fu">:</span> <span class="st">"test_primes.py"</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"file_text"</span><span class="fu">:</span> <span class="st">"import unittest</span><span class="ch">\n</span><span class="st">import primes</span><span class="ch">\n\n</span><span class="st">class TestPrimes(unittest.TestCase):</span><span class="ch">\n</span><span class="st">    def test_is_prime(self):</span><span class="ch">\n</span><span class="st">        self.assertTrue(primes.is_prime(2))</span><span class="ch">\n</span><span class="st">        self.assertTrue(primes.is_prime(3))</span><span class="ch">\n</span><span class="st">        self.assertFalse(primes.is_prime(4))</span><span class="ch">\n\n</span><span class="st">if __name__ == '__main__':</span><span class="ch">\n</span><span class="st">    unittest.main()"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>insert</strong></p>
<p>The <code>insert</code> command allows the model to insert text at a specific location in a file.</p>
<p>Parameters: - command: Must be “insert” - path: The path to the file to modify - insert_line: The line number after which to insert the text (0 for beginning of file) - new_str: The text to insert</p>
<p>Example insert command</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"input"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"command"</span><span class="fu">:</span> <span class="st">"insert"</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"path"</span><span class="fu">:</span> <span class="st">"primes.py"</span><span class="fu">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"insert_line"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"new_str"</span><span class="fu">:</span> <span class="st">"</span><span class="ch">\"\"\"</span><span class="st">Module for working with prime numbers.</span><span class="ch">\n\n</span><span class="st">This module provides functions to check if a number is prime</span><span class="ch">\n</span><span class="st">and to generate a list of prime numbers up to a given limit.</span><span class="ch">\n\"\"\"\n</span><span class="st">"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Implement the text editor tool</strong></p>
<p>1 Initialize your editor implementation</p>
<p>Create helper functions to handle file operations like reading, writing, and modifying files. Consider implementing backup functionality to recover from mistakes.</p>
<p>2 Handle editor tool calls</p>
<p>Create a function that processes tool calls from the model based on the command type:</p>
<p>3 Implement security measures</p>
<p>Add validation and security checks: - Validate file paths to prevent directory traversal - Create backups before making changes - Handle errors gracefully - Implement permissions checks</p>
<p>When implementing the text editor tool, keep in mind: - Security: The tool has access to your local filesystem, so implement proper security measures. - Backup: Always create backups before allowing edits to important files. - Validation: Validate all inputs to prevent unintended changes. - Unique matching: Make sure replacements match exactly one location to avoid unintended edits.</p>
<p><strong>Handle errors</strong></p>
<p>File not found</p>
<p>If the model tries to view or modify a file that doesn’t exist, return an appropriate error message in the tool_result: “Error: File not found”</p>
<p>Multiple matches for replacement</p>
<p>If the str_replace command matches multiple locations in the file, return an appropriate error message: “Error: Found 3 matches for replacement text. Please provide more context to make a unique match.”</p>
<p>No matches for replacement</p>
<p>If the str_replace command doesn’t match any text in the file, return an appropriate error message: “Error: No match found for replacement. Please check your text and try again.”</p>
<p>Permission errors</p>
<p>If there are permission issues with creating, reading, or modifying files, return an appropriate error message: “Error: Permission denied. Cannot write to file.”</p>
<p><strong>Implementation best practices</strong></p>
<p>Provide clear context</p>
<p>When asking the model to fix or modify code, be specific about what files need to be examined or what issues need to be addressed. Clear context helps the model identify the right files and make appropriate changes.</p>
<ul>
<li>Less helpful prompt: “Can you fix my code?”</li>
<li>Better prompt: “There’s a syntax error in my primes.py file that prevents it from running. Can you fix it?”</li>
</ul>
<p>Be explicit about file paths</p>
<p>Specify file paths clearly when needed, especially if you’re working with multiple files or files in different directories. - Less helpful prompt: “Review my helper file” - Better prompt: “Can you check my utils/helpers.py file for any performance issues?”</p>
<p>Create backups before editing</p>
<p>Implement a backup system in your application that creates copies of files before allowing the model to edit them, especially for important or production code.</p>
<p>Handle unique text replacement carefully</p>
<p>The str_replace command requires an exact match for the text to be replaced. Your application should ensure that there is exactly one match for the old text or provide appropriate error messages.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Error: No match found"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> count <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"Error: Found </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> matches"</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Successfully replaced text"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Verify changes</p>
<p>After the model makes changes to a file, verify the changes by running tests or checking that the code still works as expected.</p>
<section id="answerai-text-editor-tools-implementation" class="level3">
<h3 class="anchored" data-anchor-id="answerai-text-editor-tools-implementation">Answerai Text editor tools implementation</h3>
<p>Implementation from https://github.com/AnswerDotAI/claudette</p>
<p>Implements functions for Anthropic’s Text Editor Tool API, allowing a model to view and edit files.</p>
<div id="ab10428d-eb23-45ae-8117-36a7863faf99" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T14:43:07.257168Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T14:43:07.257022Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T14:43:07.260481Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T14:43:07.260101Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T14:43:07.257159Z&quot;}}" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view(path:<span class="bu">str</span>,  <span class="co"># The path to the file or directory to view</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>         view_range:<span class="bu">tuple</span>[<span class="bu">int</span>,<span class="bu">int</span>]<span class="op">=</span><span class="va">None</span>, <span class="co"># Optional array of two integers specifying the start and end line numbers to view. Line numbers are 1-indexed, and -1 for the end line means read to the end of the file. This parameter only applies when viewing files, not directories.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         nums:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span> <span class="co"># Optionally prefix all lines of the file with a line number</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">'Examine the contents of a file or list the contents of a directory. It can read the entire file or a specific range of lines. With or without line numbers.'</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> Path(path).expanduser().resolve()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> p.exists(): <span class="cf">return</span> <span class="ss">f'Error: File not found: </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p.is_dir():</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            res <span class="op">=</span> [<span class="bu">str</span>(f) <span class="cf">for</span> f <span class="kw">in</span> p.glob(<span class="st">'**/*'</span>) </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">if</span> <span class="kw">not</span> <span class="bu">any</span>(part.startswith(<span class="st">'.'</span>) <span class="cf">for</span> part <span class="kw">in</span> f.relative_to(p).parts)]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f'Directory contents of </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="ss">'</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(res)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> p.read_text().splitlines()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        s,e <span class="op">=</span> <span class="dv">1</span>,<span class="bu">len</span>(lines)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> view_range:</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            s,e <span class="op">=</span> view_range</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">1</span> <span class="op">&lt;=</span> s <span class="op">&lt;=</span> <span class="bu">len</span>(lines)): <span class="cf">return</span> <span class="ss">f'Error: Invalid start line </span><span class="sc">{</span>s<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> e <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> <span class="kw">not</span> (s <span class="op">&lt;=</span> e <span class="op">&lt;=</span> <span class="bu">len</span>(lines)): <span class="cf">return</span> <span class="ss">f'Error: Invalid end line </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            lines <span class="op">=</span> lines[s<span class="op">-</span><span class="dv">1</span>:<span class="va">None</span> <span class="cf">if</span> e<span class="op">==-</span><span class="dv">1</span> <span class="cf">else</span> e]</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join([<span class="ss">f'</span><span class="sc">{</span>i<span class="op">+</span>s<span class="op">-</span><span class="dv">1</span><span class="sc">:6d}</span><span class="ss"> │ </span><span class="sc">{</span>l<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i,l <span class="kw">in</span> <span class="bu">enumerate</span>(lines,<span class="dv">1</span>)] <span class="cf">if</span> nums <span class="cf">else</span> lines)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e: <span class="cf">return</span> <span class="ss">f'Error viewing file: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="9a5588a6-1354-489b-9846-7fa23549731b" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T14:43:08.014265Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T14:43:08.014158Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T14:43:08.018314Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T14:43:08.017124Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T14:43:08.014253Z&quot;}}" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(view(<span class="st">'styles.css'</span>, (<span class="dv">1</span>,<span class="dv">10</span>), nums<span class="op">=</span><span class="va">True</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     1 │ .cell {
     2 │   margin-bottom: 1rem;
     3 │ }
     4 │ 
     5 │ .cell &gt; .sourceCode {
     6 │   margin-bottom: 0;
     7 │ }
     8 │ 
     9 │ .cell-output &gt; pre {
    10 │   margin-bottom: 0;</code></pre>
</div>
</div>
<div id="478bef6c-d42d-4608-8168-6ea4abb3f85f" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T14:56:24.014260Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T14:56:24.014184Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T14:56:24.016967Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T14:56:24.016345Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T14:56:24.014253Z&quot;}}" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create(path: <span class="bu">str</span>, <span class="co"># The path where the new file should be created</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>           file_text: <span class="bu">str</span>, <span class="co"># The text content to write to the new file</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>           overwrite:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span> <span class="co"># Allows overwriting an existing file</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>          ) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">'Creates a new file with the given text content at the specified path'</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> Path(path)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p.exists():</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> overwrite: <span class="cf">return</span> <span class="ss">f'Error: File already exists: </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        p.parent.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        p.write_text(file_text)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f'Created file </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss"> containing:</span><span class="ch">\n</span><span class="sc">{</span>file_text<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e: <span class="cf">return</span> <span class="ss">f'Error creating file: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="e99053bd-2b9a-42ca-be82-a493698f6a58" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T14:56:30.575820Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T14:56:30.575734Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T14:56:30.581116Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T14:56:30.580331Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T14:56:30.575813Z&quot;}}" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(create(<span class="st">'test.txt'</span>, <span class="st">'Hello, world!'</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(view(<span class="st">'test.txt'</span>, nums<span class="op">=</span><span class="va">True</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Created file test.txt containing:
Hello, world!
     1 │ Hello, world!</code></pre>
</div>
</div>
<div id="50bd2d71-53c1-406c-ab06-8d118e4bfe45" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T15:03:08.934050Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T15:03:08.933978Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T15:03:08.937122Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T15:03:08.935878Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T15:03:08.934043Z&quot;}}" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert(path: <span class="bu">str</span>,  <span class="co"># The path to the file to modify</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>           insert_line: <span class="bu">int</span>, <span class="co"># The line number after which to insert the text (0 for beginning of file)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>           new_str: <span class="bu">str</span> <span class="co"># The text to insert</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>          ) <span class="op">-&gt;</span> <span class="bu">str</span>: </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">'Insert text at a specific line number in a file.'</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> Path(path)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> p.exists(): <span class="cf">return</span> <span class="ss">f'Error: File not found: </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> p.read_text().splitlines()</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">0</span> <span class="op">&lt;=</span> insert_line <span class="op">&lt;=</span> <span class="bu">len</span>(content)): <span class="cf">return</span> <span class="ss">f'Error: Invalid line number </span><span class="sc">{</span>insert_line<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        content.insert(insert_line, new_str)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        new_content <span class="op">=</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(content)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        p.write_text(new_content)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f'Inserted text at line </span><span class="sc">{</span>insert_line<span class="sc">}</span><span class="ss"> in </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">.</span><span class="ch">\n</span><span class="ss">New contents:</span><span class="ch">\n</span><span class="sc">{</span>new_content<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e: <span class="cf">return</span> <span class="ss">f'Error inserting text: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="38c416cf-a07d-4c0c-8e70-15ec1eb5c876" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T15:03:13.489472Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T15:03:13.489394Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T15:03:13.502531Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T15:03:13.501279Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T15:03:13.489465Z&quot;}}" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>insert(<span class="st">'test.txt'</span>, <span class="dv">0</span>, <span class="st">'Let</span><span class="ch">\'</span><span class="st">s add a new line'</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(view(<span class="st">'test.txt'</span>, nums<span class="op">=</span><span class="va">True</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     1 │ Let's add a new line
     2 │ Hello, world!</code></pre>
</div>
</div>
<div id="1ed91b4f-3d8d-4bc8-b584-e29888a0eb30" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T15:05:59.874447Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T15:05:59.874294Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T15:05:59.877701Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T15:05:59.876998Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T15:05:59.874437Z&quot;}}" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> str_replace(path: <span class="bu">str</span>, <span class="co"># The path to the file to modify</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                old_str: <span class="bu">str</span>, <span class="co"># The text to replace (must match exactly, including whitespace and indentation)</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                new_str: <span class="bu">str</span> <span class="co"># The new text to insert in place of the old text</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>               ) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">'Replace a specific string in a file with a new string. This is used for making precise edits.'</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> Path(path)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> p.exists(): <span class="cf">return</span> <span class="ss">f'Error: File not found: </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> p.read_text()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> content.count(old_str)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">==</span> <span class="dv">0</span>: <span class="cf">return</span> <span class="st">'Error: Text not found in file'</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">1</span>: <span class="cf">return</span> <span class="ss">f'Error: Multiple matches found (</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)'</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        new_content <span class="op">=</span> content.replace(old_str, new_str, <span class="dv">1</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        p.write_text(new_content)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f'Replaced text in </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">.</span><span class="ch">\n</span><span class="ss">New contents:</span><span class="ch">\n</span><span class="sc">{</span>new_content<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e: <span class="cf">return</span> <span class="ss">f'Error replacing text: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="566c1452-f9b1-4e8e-b0c7-182745289346" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T15:06:01.081360Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T15:06:01.081281Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T15:06:01.084072Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T15:06:01.083614Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T15:06:01.081353Z&quot;}}" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>str_replace(<span class="st">'test.txt'</span>, <span class="st">'new line'</span>, <span class="st">''</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(view(<span class="st">'test.txt'</span>, nums<span class="op">=</span><span class="va">True</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     1 │ Let's add a 
     2 │ Hello, world!</code></pre>
</div>
</div>
</section>
</section>
<section id="bash-tool" class="level2">
<h2 class="anchored" data-anchor-id="bash-tool">Bash tool</h2>
<p>The bash tool enables the model to execute shell commands in a persistent bash session, allowing system operations, script execution, and command-line automation.</p>
<p><strong>Overview</strong></p>
<p>The bash tool provides the model with: - Persistent bash session that maintains state - Ability to run any shell command - Access to environment variables and working directory - Command chaining and scripting capabilities</p>
<p><strong>Use cases</strong></p>
<ul>
<li>Development workflows: Run build commands, tests, and development tools</li>
<li>System automation: Execute scripts, manage files, automate tasks</li>
<li>Data processing: Process files, run analysis scripts, manage datasets</li>
<li>Environment setup: Install packages, configure environments</li>
</ul>
<p><strong>How it works</strong></p>
<p>The bash tool maintains a persistent session: 1. the model determines what command to run 2. you execute the command in a bash shell 3. reurn the output (stdout and stderr) to the model 4. session state persists between commands (environment variables, working directory)</p>
<p><strong>Parameters</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>command</code></td>
<td>Yes*</td>
<td>The bash command to run</td>
</tr>
<tr class="even">
<td><code>restart</code></td>
<td>No</td>
<td>Set to true to restart the bash session</td>
</tr>
</tbody>
</table>
<p>*Required unless using <code>restart</code></p>
<p><strong>Example: Multi-step automation</strong></p>
<p>The model can chain commands to complete complex tasks:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># User request</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="st">"Install the requests library and create a simple Python script that fetches a joke from an API, then run it."</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Model tool calls:</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Install package</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">{</span><span class="st">"command"</span><span class="ex">:</span> <span class="st">"pip install requests"</span>}</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create script</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="ex">{</span><span class="st">"command"</span><span class="ex">:</span> <span class="st">"cat &gt; fetch_joke.py &lt;&lt; 'EOF'\nimport requests\nresponse = requests.get('https://official-joke-api.appspot.com/random_joke')\njoke = response.json()\nprint(f</span><span class="dt">\"</span><span class="st">Setup: {joke['setup']}</span><span class="dt">\"</span><span class="st">)\nprint(f</span><span class="dt">\"</span><span class="st">Punchline: {joke['punchline']}</span><span class="dt">\"</span><span class="st">)\nEOF"</span>}</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Run script</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="ex">{</span><span class="st">"command"</span><span class="ex">:</span> <span class="st">"python fetch_joke.py"</span>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The session maintains state between commands, so files created in step 2 are available in step 3.</p>
<p><strong>Handle errors</strong></p>
<p>Command execution timeout - If a command takes too long to execute: “Error: Command timed out after 30 seconds”</p>
<p>Command not found - If a command doesn’t exist: “bash: nonexistentcommand: command not found”</p>
<p>Permission denied - If there are permission issues: “bash: /root/sensitive-file: Permission denied”</p>
<p><strong>Implementation best practices</strong></p>
<p>Use command timeouts: Implement timeouts to prevent hanging commands.</p>
<p>Maintain session state: Keep the bash session persistent to maintain environment variables and working directory.</p>
<p>Handle large outputs: Truncate very large outputs to prevent token limit issues.</p>
<p>Log all commands: Keep an audit trail of executed commands.</p>
<p>Sanitize outputs: Remove sensitive information from command outputs.</p>
<p><strong>Security</strong></p>
<p>The bash tool provides direct system access. Implement these essential safety measures: - Running in isolated environments (Docker/VM) - Implementing command filtering and allowlists - Setting resource limits (CPU, memory, disk) - Logging all executed commands</p>
<p>Key recommendations - Use ulimit to set resource constraints - Filter dangerous commands (sudo, rm -rf, etc.) - Run with minimal user permissions - Monitor and log all command execution</p>
<p><strong>Common patterns</strong></p>
<p>Development workflows - Running tests: pytest &amp;&amp; coverage report - Building projects: npm install &amp;&amp; npm run build - Git operations: git status &amp;&amp; git add . &amp;&amp; git commit -m “message”</p>
<p>File operations - Processing data: wc -l <em>.csv &amp;&amp; ls -lh </em>.csv - Searching files: find . -name “*.py” | xargs grep “pattern” - Creating backups: tar -czf backup.tar.gz ./data</p>
<p>System tasks - Checking resources: df -h &amp;&amp; free -m - Process management: ps aux | grep python - Environment setup: export PATH=PATH:/new/path &amp;&amp; echo PATH</p>
<p><strong>Limitations</strong></p>
<ul>
<li>No interactive commands: Cannot handle vim, less, or password prompts</li>
<li>No GUI applications: Command-line only</li>
<li>Session scope: Persists within conversation, lost between API calls</li>
<li>Output limits: Large outputs may be truncated</li>
<li>No streaming: Results returned after completion</li>
</ul>
<p><strong>Combining with other tools</strong></p>
<p>The bash tool is most powerful when combined with the text editor and other tools.</p>
</section>
<section id="code-execution-tool" class="level2">
<h2 class="anchored" data-anchor-id="code-execution-tool">Code execution tool</h2>
<p>Code execution tool = bash tool + text editor tool <strong>in a remote container</strong>.</p>
<p>The code execution tool defined by Anthropic is implemented as a remote execution container, and most of its features are designed around the interaction between a local and remote cloud environment.</p>
<p>In our wordslab-notebooks context, we want to execute everything locally, so we will only keep a few interesting parts of the Anthropic documentation.</p>
<p>When this tool is provided, the model automatically gains access to two sub-tools: - bash_code_execution: Run shell commands - text_editor_code_execution: View, create, and edit files, including writing code</p>
<p><strong>How code execution works</strong></p>
<p>When you add the code execution tool to your API request: 1. The model evaluates whether code execution would help answer your question 2. The tool automatically provides the model with the following capabilities: - Bash commands: Execute shell commands for system operations and package management - File operations: Create, view, and edit files directly, including writing code 3. The model can use any combination of these capabilities in a single request 4. All operations run in a secure sandbox environment 5. The tool provides results with any generated charts, calculations, or analysis</p>
<p><strong>Containers</strong></p>
<p>The code execution tool runs in a secure, containerized environment designed specifically for code execution, with a higher focus on Python.</p>
<p>Runtime environment - Python version: 3.11.12 - Operating system: Linux-based container - Architecture: x86_64 (AMD64)</p>
<p>Resource limits - Memory: 5GiB RAM - Disk space: 5GiB workspace storage - CPU: 1 CPU</p>
<p>Networking and security - Internet access: Completely disabled for security - External connections: No outbound network requests permitted - Sandbox isolation: Full isolation from host system and other containers - File access: Limited to workspace directory only - Workspace scoping: Like Files, containers are scoped to the workspace of the API key - Expiration: Containers expire 30 days after creation</p>
<p>Pre-installed libraries - Data Science: pandas, numpy, scipy, scikit-learn, statsmodels - Visualization: matplotlib, seaborn - File Processing: pyarrow, openpyxl, xlsxwriter, xlrd, pillow, python-pptx, python-docx, pypdf, pdfplumber, pypdfium2, pdf2image, pdfkit, tabula-py, reportlab[pycairo], Img2pdf - Math &amp; Computing: sympy, mpmath - Utilities: tqdm, python-dateutil, pytz, joblib, unzip, unrar, 7zip, bc, rg (ripgrep), fd, sqlite</p>
<p>Container reuse - You can reuse an existing container across multiple API requests by providing the container ID from a previous response. - This allows you to maintain created files between requests.</p>
<p><strong>How to use the tool</strong></p>
<p>Execute Bash commands</p>
<p>Ask the model to check system information and install packages: “Check the Python version and list installed packages”</p>
<p>Create and edit files directly</p>
<p>The model can create, view, and edit files directly in the sandbox using the file manipulation capabilities: “Create a config.yaml file with database settings, then update the port from 5432 to 3306”</p>
<p>Upload and analyze your own files</p>
<p>To analyze your own data files (CSV, Excel, images, etc.), upload them via the Files API and reference them in your request: “Analyze this CSV data”</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="er">"content":</span> <span class="ot">[</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">{</span><span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span><span class="fu">,</span> <span class="dt">"text"</span><span class="fu">:</span> <span class="st">"Analyze this CSV data"</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">{</span><span class="dt">"type"</span><span class="fu">:</span> <span class="st">"container_upload"</span><span class="fu">,</span> <span class="dt">"file_id"</span><span class="fu">:</span> <span class="st">"file_abc123"</span><span class="fu">}</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>            <span class="ot">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Retrieve generated files</p>
<p>When the tool creates files during code execution, you can retrieve these files using the Files API: “Create a matplotlib visualization and save it as output.png” - Extract file IDs from the response - Download the created files</p>
<p>Combine operations</p>
<p>A complex workflow using all capabilities: - First, upload a file - Extract file_id - Then use it with code execution - “Analyze this CSV data: create a summary report, save visualizations, and create a README with the findings”</p>
<p><strong>Response format</strong></p>
<p>The code execution tool can return two types of results depending on the operation:</p>
<p>Bash command response</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>    <span class="er">"stdout":</span> <span class="er">"total</span> <span class="er">24\ndrwxr-xr-x</span> <span class="er">2</span> <span class="er">user</span> <span class="er">user</span> <span class="er">4096</span> <span class="er">Jan</span> <span class="er">1</span> <span class="er">12:00</span> <span class="er">.\ndrwxr-xr-x</span> <span class="er">3</span> <span class="er">user</span> <span class="er">user</span> <span class="er">4096</span> <span class="er">Jan</span> <span class="er">1</span> <span class="er">11:00</span> <span class="er">..\n-rw-r--r--</span> <span class="er">1</span> <span class="er">user</span> <span class="er">user</span>  <span class="er">220</span> <span class="er">Jan</span> <span class="er">1</span> <span class="er">12:00</span> <span class="er">data.csv\n-rw-r--r--</span> <span class="er">1</span> <span class="er">user</span> <span class="er">user</span>  <span class="er">180</span> <span class="er">Jan</span> <span class="er">1</span> <span class="er">12:00</span> <span class="er">config.json",</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="er">"stderr":</span> <span class="er">"",</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">"return_code":</span> <span class="er">0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>File operation responses</p>
<ul>
<li>View file</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>    <span class="er">"file_type":</span> <span class="er">"text",</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="er">"content":</span> <span class="er">"</span><span class="fu">{</span><span class="er">\n</span>  <span class="er">\</span><span class="dt">"setting</span><span class="ch">\"</span><span class="dt">: </span><span class="ch">\"</span><span class="dt">value</span><span class="ch">\"</span><span class="dt">,</span><span class="ch">\n</span><span class="dt">  </span><span class="ch">\"</span><span class="dt">debug</span><span class="ch">\"</span><span class="dt">: true</span><span class="ch">\n</span><span class="dt">}"</span><span class="fu">,</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"numLines"</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"startLine"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"totalLines"</span><span class="fu">:</span> <span class="dv">4</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Create file
<ul>
<li>is_file_update: whether file already existed</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>  <span class="er">"is_file_update":</span> <span class="er">false</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li>Edit file (str_replace)
<ul>
<li>lines: diff format</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>  <span class="er">"oldStart":</span> <span class="er">3,</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">"oldLines":</span> <span class="er">1,</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">"newStart":</span> <span class="er">3,</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">"newLines":</span> <span class="er">1,</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="er">"lines":</span> <span class="ot">[</span><span class="st">"-  </span><span class="ch">\"</span><span class="st">debug</span><span class="ch">\"</span><span class="st">: true"</span><span class="ot">,</span> <span class="st">"+  </span><span class="ch">\"</span><span class="st">debug</span><span class="ch">\"</span><span class="st">: false"</span><span class="ot">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ul>
<p><strong>Errors</strong></p>
<p>Error codes by tool type:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 30%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th>Tool</th>
<th>Error Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>All tools</td>
<td>unavailable</td>
<td>The tool is temporarily unavailable</td>
</tr>
<tr class="even">
<td>All tools</td>
<td>execution_time_exceeded</td>
<td>Execution exceeded maximum time limit</td>
</tr>
<tr class="odd">
<td>All tools</td>
<td>container_expired</td>
<td>Container expired and is no longer available</td>
</tr>
<tr class="even">
<td>All tools</td>
<td>invalid_tool_input</td>
<td>Invalid parameters provided to the tool</td>
</tr>
<tr class="odd">
<td>All tools</td>
<td>too_many_requests</td>
<td>Rate limit exceeded for tool usage</td>
</tr>
<tr class="even">
<td>text_editor</td>
<td>file_not_found</td>
<td>File doesn’t exist (for view/edit operations)</td>
</tr>
<tr class="odd">
<td>text_editor</td>
<td>string_not_found</td>
<td>The old_str not found in file (for str_replace)</td>
</tr>
</tbody>
</table>
<p><strong>Programmatic tool calling</strong></p>
<p>The code execution tool powers programmatic tool calling, which allows the model to write code that calls your custom tools programmatically within the execution container. This enables efficient multi-tool workflows, data filtering before reaching the model’s context, and complex conditional logic.</p>
<p>Enable programmatic calling for your tools:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>    <span class="er">tools=</span><span class="ot">[</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"get_weather"</span><span class="fu">,</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Get weather for a city"</span><span class="fu">,</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"input_schema"</span><span class="fu">:</span> <span class="fu">{</span><span class="er">...</span><span class="fu">},</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"allowed_callers"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"code_execution_20250825"</span><span class="ot">]</span>  <span class="er">#</span> <span class="er">Enable</span> <span class="er">programmatic</span> <span class="er">calling</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Learn more in the Programmatic tool calling documentation.</p>
<p><strong>Using code execution with Agent Skills</strong></p>
<p>The code execution tool enables the mdeol to use Agent Skills. Skills are modular capabilities consisting of instructions, scripts, and resources that extend the model’s functionality.</p>
<p>Learn more in the Agent Skills documentation and Agent Skills API guide.</p>
</section>
<section id="code-interpreter" class="level2">
<h2 class="anchored" data-anchor-id="code-interpreter">Code interpreter</h2>
<p>From https://github.com/AnswerDotAI/claudette</p>
<p>Code interpreter Here is an example of using toolloop to implement a simple code interpreter with additional tools.</p>
<p>from toolslm.shell import get_shell from fastcore.meta import delegates import traceback</p>
<p><span class="citation" data-cites="delegates">@delegates</span>() class CodeChat(Chat): imps = ‘os, warnings, time, json, re, math, collections, itertools, functools, dateutil, datetime, string, types, copy, pprint, enum, numbers, decimal, fractions, random, operator, typing, dataclasses’ def <strong>init</strong>(self, model: Optional[str] = None, ask:bool=True, **kwargs): super().__init__(model=model, **kwargs) self.ask = askm self.tools.append(self.run_cell) self.shell = get_shell() self.shell.run_cell(‘import’+self.imps)</p>
<p>We have one additional parameter to creating a CodeChat beyond what we pass to Chat, which is ask – if that’s True, we’ll prompt the user before running code.</p>
<p><span class="citation" data-cites="patch">@patch</span> def run_cell( self:CodeChat, code:str, # Code to execute in persistent IPython session )-&gt;str: “““Asks user for permission, and if provided, executes python <code>code</code> using persistent IPython session. Returns: Result of expression on last line (if exists); ‘#DECLINED#’ if user declines request to execute”“” confirm = f’Press Enter to execute, or enter “n” to skip?<code>\n{code}\n</code>’ if self.ask and input(confirm): return ‘#DECLINED#’ try: res = self.shell.run_cell(code) except Exception as e: return traceback.format_exc() return res.stdout if res.result is None else res.result</p>
</section>
<section id="web-fetch-tool" class="level2">
<h2 class="anchored" data-anchor-id="web-fetch-tool">Web fetch tool</h2>
<p>The web fetch tool allows the model to retrieve full content from specified web pages and PDF documents.</p>
<p><strong>Security Warning</strong></p>
<p>Enabling the web fetch tool in environments where the model processes untrusted input alongside sensitive data poses data exfiltration risks. We recommend only using this tool in trusted environments or when handling non-sensitive data.</p>
<p>To minimize exfiltration risks, the model should not be allowed to dynamically construct URLs. The system should only fetch URLs that have been explicitly provided by the user or that come from previous web search or web fetch results. However, there is still residual risk that should be carefully considered when using this tool.</p>
<p>If data exfiltration is a concern, consider: - Disabling the web fetch tool entirely - Using the max_uses parameter to limit the number of requests - Using the allowed_domains parameter to restrict to known safe domains</p>
<p><strong>How web fetch works</strong></p>
<p>When you add the web fetch tool to your API request: - The model decides when to fetch content based on the prompt and available URLs. - The tools retrieves the full text content from the specified URL. - For PDFs, automatic text extraction is performed. - The model analyzes the fetched content and provides a response with optional citations. - The web fetch tool currently does not support web sites dynamically rendered via Javascript.</p>
<p><strong>Parameters</strong></p>
<p>The web fetch tool supports the following parameters: - max_uses = 10: Optional: Limit the number of fetches per request - allowed_domains = [“example.com”, “docs.example.com”]: Optional: Only fetch from these domains - blocked_domains = [“private.example.com”]: Optional: Never fetch from these domains - citations = {“enabled”: true}: Optional: Enable citations for fetched content - max_content_tokens=100000: Optional: Maximum content length in tokens</p>
<section id="answerai-web-fetch-implementation" class="level3">
<h3 class="anchored" data-anchor-id="answerai-web-fetch-implementation">Answerai web fetch implementation</h3>
<p>This tool implementation is inspired by the library <strong>ipykernel_helper</strong> from <strong>Answer.ai</strong>. As of december 2025, this library is not open source, but it is available to users in the solve.it.com environment and is a dependency of other Apache 2.0 libraries, so I think it is OK to use it as an inspiration.</p>
<hr>
</section>
<section id="read_url" class="level3">
<h3 class="anchored" data-anchor-id="read_url">read_url</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_url(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    url:<span class="bu">str</span>, as_md:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, extract_section:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, selector:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, math_mode:<span class="bu">str</span><span class="op">=</span><span class="va">None</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>This functions extracts a web page information for LLM ingestion</em> 1. Downloads a web page 2. Parses HTML 3. Optionally extracts a specific section (fragment or CSS selector) 4. Converts MathML → LaTeX 5. Optionally converts HTML → Markdown 6. Convert code sections to fenced markdown blocks 7. Makes image URLs absolute 8. Returns the processed text</p>
<hr>
</section>
<section id="scrape_url" class="level3">
<h3 class="anchored" data-anchor-id="scrape_url">scrape_url</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scrape_url(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    url</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Get the html content of a web page using the cloudscraper library to bypass Cloudflare’s anti-bot page.</em></p>
<div id="09bbb155-8cca-40e7-9b1a-1b3ef69509b9" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>url2md <span class="op">=</span> read_url(<span class="st">"https://answerdotai.github.io/toolslm/"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>url2md</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'[ toolslm ](./index.html)\n\n__\n\n  1. [toolslm](./index.html)\n\n\n\n  * [ toolslm](./index.html)\n\n  * [ xml source](./xml.html)\n\n  * [ funccall source](./funccall.html)\n\n  * [ shell source](./shell.html)\n\n  * [ Download helpers](./download.html)\n\n  * [ Markdown Hierarchy Parser](./md_hier.html)\n\n\n\n\n## On this page\n\n  * Install\n  * How to use\n    * Context creation\n\n\n\n  * [__Report an issue](https://github.com/AnswerDotAI/toolslm/issues/new)\n\n\n\n## Other Formats\n\n  * [ __CommonMark](index.html.md)\n\n\n\n# toolslm\n\nTools to make language models a bit easier to use \n\nThis is a work in progress…\n\n## Install\n    \n    \n    pip install toolslm\n\n __\n\n## How to use\n\n### Context creation\n\ntoolslm has some helpers to make it easier to generate XML context from files, for instance [`folder2ctx`](https://AnswerDotAI.github.io/toolslm/xml.html#folder2ctx):\n    \n    \n    print(folder2ctx(\'samples\', prefix=False, file_glob=\'*.py\'))\n\n__\n    \n    \n    &lt;documents&gt;&lt;document index="1"&gt;&lt;src&gt;\n    samples/sample_core.py\n    &lt;/src&gt;&lt;document-content&gt;\n    import inspect\n    empty = inspect.Parameter.empty\n    models = \'claude-3-opus-20240229\',\'claude-3-sonnet-20240229\',\'claude-3-haiku-20240307\'\n    &lt;/document-content&gt;&lt;/document&gt;&lt;/documents&gt;\n\nJSON doesn’t map as nicely to XML as the `ft` data structure from `fastcore.xml`, but for simple XML trees it can be convenient. The [`json_to_xml`](https://AnswerDotAI.github.io/toolslm/xml.html#json_to_xml) function handles that conversion:\n    \n    \n    a = dict(surname=\'Howard\', firstnames=[\'Jeremy\',\'Peter\'],\n             address=dict(state=\'Queensland\',country=\'Australia\'))\n    print(json_to_xml(a, \'person\'))\n\n__\n    \n    \n    &lt;person&gt;\n      &lt;surname&gt;Howard&lt;/surname&gt;\n      &lt;firstnames&gt;\n        &lt;item&gt;Jeremy&lt;/item&gt;\n        &lt;item&gt;Peter&lt;/item&gt;\n      &lt;/firstnames&gt;\n      &lt;address&gt;\n        &lt;state&gt;Queensland&lt;/state&gt;\n        &lt;country&gt;Australia&lt;/country&gt;\n      &lt;/address&gt;\n    &lt;/person&gt;\n\n  * [__Report an issue](https://github.com/AnswerDotAI/toolslm/issues/new)\n\n\n'</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/wordslab-org\.github\.io\/wordslab-notebooks-lib");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/wordslab-org/wordslab-notebooks-lib/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>