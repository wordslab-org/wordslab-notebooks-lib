<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Chat with local and remote LLMs in the context of the wordslab-notebooks environment">

<title>wordslab-notebooks-lib.chat – wordslab-notebooks-lib</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-000f0825b9c55ed21d14970d810c14a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="wordslab-notebooks-lib.chat – wordslab-notebooks-lib">
<meta property="og:description" content="Chat with local and remote LLMs in the context of the wordslab-notebooks environment">
<meta property="og:site_name" content="wordslab-notebooks-lib">
<meta name="twitter:title" content="wordslab-notebooks-lib.chat – wordslab-notebooks-lib">
<meta name="twitter:description" content="Chat with local and remote LLMs in the context of the wordslab-notebooks environment">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">wordslab-notebooks-lib</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chat.html">wordslab-notebooks-lib.chat</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib.core</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./env.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib.env</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chat.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">wordslab-notebooks-lib.chat</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib.tools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools_study_answerai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Answerai tools study</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools_study_anthropic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anthropic tools study</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools_study_mistral-vibe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mistral vibe 2.0</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wordslab-notebooks-lib.notebook</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#observable-conversation-turns" id="toc-observable-conversation-turns" class="nav-link active" data-scroll-target="#observable-conversation-turns">Observable conversation turns</a>
  <ul class="collapse">
  <li><a href="#refresh_notebook_display" id="toc-refresh_notebook_display" class="nav-link" data-scroll-target="#refresh_notebook_display">refresh_notebook_display</a></li>
  <li><a href="#chatturns" id="toc-chatturns" class="nav-link" data-scroll-target="#chatturns">ChatTurns</a></li>
  <li><a href="#chatturn" id="toc-chatturn" class="nav-link" data-scroll-target="#chatturn">ChatTurn</a></li>
  </ul></li>
  <li><a href="#native-tool-calling" id="toc-native-tool-calling" class="nav-link" data-scroll-target="#native-tool-calling">Native tool calling</a>
  <ul class="collapse">
  <li><a href="#get_tools_schemas_and_functions" id="toc-get_tools_schemas_and_functions" class="nav-link" data-scroll-target="#get_tools_schemas_and_functions">get_tools_schemas_and_functions</a></li>
  <li><a href="#tools" id="toc-tools" class="nav-link" data-scroll-target="#tools">Tools</a></li>
  <li><a href="#toolexecutionerror" id="toc-toolexecutionerror" class="nav-link" data-scroll-target="#toolexecutionerror">ToolExecutionError</a></li>
  </ul></li>
  <li><a href="#images" id="toc-images" class="nav-link" data-scroll-target="#images">Images</a>
  <ul class="collapse">
  <li><a href="#images-1" id="toc-images-1" class="nav-link" data-scroll-target="#images-1">Images</a></li>
  </ul></li>
  <li><a href="#model-client" id="toc-model-client" class="nav-link" data-scroll-target="#model-client">Model client</a>
  <ul class="collapse">
  <li><a href="#modelclient" id="toc-modelclient" class="nav-link" data-scroll-target="#modelclient">ModelClient</a></li>
  <li><a href="#ollama-model-client" id="toc-ollama-model-client" class="nav-link" data-scroll-target="#ollama-model-client">ollama model client</a></li>
  <li><a href="#ollamamodelclient" id="toc-ollamamodelclient" class="nav-link" data-scroll-target="#ollamamodelclient">OllamaModelClient</a></li>
  <li><a href="#openrouter-chat-client" id="toc-openrouter-chat-client" class="nav-link" data-scroll-target="#openrouter-chat-client">openrouter chat client</a></li>
  <li><a href="#openroutermodelclient" id="toc-openroutermodelclient" class="nav-link" data-scroll-target="#openroutermodelclient">OpenRouterModelClient</a></li>
  </ul></li>
  <li><a href="#models-providers" id="toc-models-providers" class="nav-link" data-scroll-target="#models-providers">Models providers</a>
  <ul class="collapse">
  <li><a href="#design-concepts" id="toc-design-concepts" class="nav-link" data-scroll-target="#design-concepts">Design concepts</a></li>
  <li><a href="#list-download-and-load-models" id="toc-list-download-and-load-models" class="nav-link" data-scroll-target="#list-download-and-load-models">List, download and load models</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/wordslab-org/wordslab-notebooks-lib/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="chat.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">wordslab-notebooks-lib.chat</h1>
</div>

<div>
  <div class="description">
    Chat with local and remote LLMs in the context of the wordslab-notebooks environment
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="observable-conversation-turns" class="level2">
<h2 class="anchored" data-anchor-id="observable-conversation-turns">Observable conversation turns</h2>
<hr>
<section id="refresh_notebook_display" class="level3">
<h3 class="anchored" data-anchor-id="refresh_notebook_display">refresh_notebook_display</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> refresh_notebook_display(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    hide_thinking:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, hide_tool_calls:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
<section id="chatturns" class="level3">
<h3 class="anchored" data-anchor-id="chatturns">ChatTurns</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ChatTurns(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    refresh_display:Callable<span class="op">=</span><span class="va">None</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Initialize self. See help(type(self)) for accurate signature.</em></p>
<hr>
</section>
<section id="chatturn" class="level3">
<h3 class="anchored" data-anchor-id="chatturn">ChatTurn</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ChatTurn(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    refresh_display:Callable<span class="op">=</span><span class="va">None</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Initialize self. See help(type(self)) for accurate signature.</em></p>
<div id="d1362b05-cffa-4d19-83c5-49c010c1750d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>turns <span class="op">=</span> ChatTurns(refresh_notebook_display(hide_thinking<span class="op">=</span><span class="va">False</span>, hide_tool_calls<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>turn <span class="op">=</span> turns.new_turn()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>turn.append_thinking(<span class="st">"I think a lot longer.</span><span class="ch">\n</span><span class="st">In sentences.</span><span class="ch">\n\n</span><span class="st">With line breaks."</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="fl">0.5</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>turn.append_content(<span class="st">"I need to call 2 tools."</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="fl">0.5</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>turn.append_tool_call(<span class="st">"myfunc"</span>, {<span class="st">"param1"</span>: <span class="st">"value1"</span>, <span class="st">"param2"</span>: <span class="st">"value2"</span>})</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>turn.start_tool_call(<span class="st">"myfunc"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="fl">0.5</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>turn.end_tool_call(<span class="st">"myfunc"</span>, <span class="fl">17.43</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>turn1 <span class="op">=</span> turn</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>turn <span class="op">=</span> turns.new_turn()</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>turn.append_thinking(<span class="st">"Ok, I got the first result, now call the second tool."</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="fl">0.5</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>turn.append_tool_call(<span class="st">"myfunc2"</span>, {})</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>turn.start_tool_call(<span class="st">"myfunc2"</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="fl">0.5</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>turn.end_tool_call(<span class="st">"myfunc2"</span>, <span class="st">"The weather is nice today but clouds an wind are coming for tommorow and the rest of the week will be awful"</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>turn <span class="op">=</span> turns.new_turn()</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>turn.append_thinking(<span class="st">"Ok, I got the second result, now I can answer the question."</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="fl">0.5</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>turn.append_content(<span class="st">"This is the incredible result."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking]</p>
</blockquote>
<blockquote class="blockquote">
<p>I think a lot longer. In sentences.</p>
<p>With line breaks.</p>
</blockquote>
<p>I need to call 2 tools.</p>
<blockquote class="blockquote">
<p>[Tool call] - model wants to call <code>myfunc</code> with parameters <code>{'param1': 'value1', 'param2': 'value2'}</code> - agent called myfunc at 22:02:46 - myfunc returned <code>17.43</code> in 0.503 sec</p>
</blockquote>
<blockquote class="blockquote">
<p>[Thinking]</p>
</blockquote>
<blockquote class="blockquote">
<p>Ok, I got the first result, now call the second tool.</p>
</blockquote>
<blockquote class="blockquote">
<p>[Tool call] - model wants to call <code>myfunc2</code> with parameters <code>{}</code> - agent called myfunc2 at 22:02:47 - myfunc2 returned <code>The weather is nice today but clouds an wind are coming for tommorow and the rest of the week wil...</code> in 0.503 sec</p>
</blockquote>
<blockquote class="blockquote">
<p>[Thinking]</p>
</blockquote>
<blockquote class="blockquote">
<p>Ok, I got the second result, now I can answer the question.</p>
</blockquote>
<p>This is the incredible result.</p>
</div>
</div>
<div id="da052dd6-95d7-46fa-a90e-cca3ab599d13" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>turn1.thinking, turn1.content</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>('I think a lot longer.\nIn sentences.\n\nWith line breaks.',
 'I need to call 2 tools.')</code></pre>
</div>
</div>
<div id="ac35c7a8-c1cc-49b5-bb87-ef5cbf8d6509" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Markdown(turn1.to_markdown())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 10 words</p>
</blockquote>
<p>I need to call 2 tools.</p>
<blockquote class="blockquote">
<p>[Tool call] … <code>myfunc</code> returned <code>17.43</code></p>
</blockquote>
</div>
</div>
<div id="c9fd10db-4630-436e-92ad-70f301858105" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Markdown(turn1.to_markdown(hide_thinking<span class="op">=</span><span class="va">False</span>, hide_tool_calls<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking]</p>
</blockquote>
<blockquote class="blockquote">
<p>I think a lot longer. In sentences.</p>
<p>With line breaks.</p>
</blockquote>
<p>I need to call 2 tools.</p>
<blockquote class="blockquote">
<p>[Tool call] - model wants to call <code>myfunc</code> with parameters <code>{'param1': 'value1', 'param2': 'value2'}</code> - agent called myfunc at 22:02:46 - myfunc returned <code>17.43</code> in 0.503 sec</p>
</blockquote>
</div>
</div>
</section>
</section>
<section id="native-tool-calling" class="level2">
<h2 class="anchored" data-anchor-id="native-tool-calling">Native tool calling</h2>
<p>Use python functions as tools callable by Large Language Models.</p>
<p>The python functions must be fully documented: - type annotations are mandatory on all parameters and on the return type - a docstring after the function definition is mandatory, it should explain the return value - a descriptive comment after each parameter is also mandatory - the expected format is: one parameter by line, a traditional python comment at the end of the line</p>
<div id="9131fc4a-84c0-4904-80ea-4a26246fe6a3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(a: <span class="bu">int</span>,  <span class="co"># The first number</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>        b: <span class="bu">int</span>   <span class="co"># The second number</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>       ) <span class="op">-&gt;</span> <span class="bu">int</span>: <span class="co"># The sum of the two numbers</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Add two numbers"""</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a <span class="op">+</span> b</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> multiply(a: <span class="bu">int</span>,  <span class="co"># The first number </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>             b: <span class="bu">int</span>   <span class="co"># The second number</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            ) <span class="op">-&gt;</span> <span class="bu">int</span>: <span class="co"># The product of the two numbers</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Multiply two numbers"""</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a <span class="op">*</span> b</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Tool description format for ollama API</strong></p>
<p>Here is the code used to process the tools parameter:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> unprocessed_tool <span class="kw">in</span> tools <span class="kw">or</span> []:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">yield</span> convert_function_to_tool(unprocessed_tool) <span class="cf">if</span> <span class="bu">callable</span>(unprocessed_tool) <span class="cf">else</span> Tool.model_validate(unprocessed_tool)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>So we can pass either a list of pyhton functions or a list of dictionaries conforming to a specific tool schema.</p>
<p>Here are the expectations for the python functions documentation:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_function_to_tool(func: Callable) <span class="op">-&gt;</span> Tool:</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">-&gt;</span> <span class="kw">def</span> _parse_docstring(doc_string: Union[<span class="bu">str</span>, <span class="va">None</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">str</span>]:</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> line <span class="kw">in</span> doc_string.splitlines():</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> lowered_line.startswith(<span class="st">'args:'</span>):</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      key <span class="op">=</span> <span class="st">'args'</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> lowered_line.startswith((<span class="st">'returns:'</span>, <span class="st">'yields:'</span>, <span class="st">'raises:'</span>)):</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      key <span class="op">=</span> <span class="st">'_'</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> line <span class="kw">in</span> parsed_docstring[<span class="st">'args'</span>].splitlines():</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">':'</span> <span class="kw">in</span> line:</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Split the line on either:</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 1. A parenthetical expression like (integer) - captured in group 1</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 2. A colon :</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Followed by optional whitespace. Only split on first occurrence.</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>      ...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is much less robust and readable than what <a href="https://AnswerDotAI.github.io/toolslm/funccall.html#get_schema"><code>toolslm.funccall.get_schema</code></a> does, so we will preprocess the list of python functions ourselves.</p>
<p>Now let’s see what tool description schema is expected by ollama.</p>
<p>pydantic Tool.model_validate() accepts: - dict - Pydantic model instances - Objects with attributes (ORM-style, if configured)</p>
<p>Here is the ollama schema:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Tool(SubscriptableBaseModel):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">type</span>: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="st">'function'</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> Function(SubscriptableBaseModel):</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    name: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    description: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Parameters(SubscriptableBaseModel):</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      model_config <span class="op">=</span> ConfigDict(populate_by_name<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="bu">type</span>: Optional[Literal[<span class="st">'object'</span>]] <span class="op">=</span> <span class="st">'object'</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      defs: Optional[Any] <span class="op">=</span> Field(<span class="va">None</span>, alias<span class="op">=</span><span class="st">'$defs'</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      items: Optional[Any] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      required: Optional[Sequence[<span class="bu">str</span>]] <span class="op">=</span> <span class="va">None</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>So this is the schema expected by the openai completions API, as we will see below.</p>
<p><strong>Tool description formats for the openai API</strong></p>
<p>The legacy openai completions API: <code>client.chat.completions.create(...)</code> expects tools to be described in a json format that uses the “wrapped function” schema:</p>
<pre><code>tool = {
  type: "function",
  function: {
    name,
    description,
    parameters
  }
}</code></pre>
<p>This is the canonical format for Chat Completions and is what OpenAI examples historically used.</p>
<p>This format does not work for the new API: <code>client.responses.create(...)</code></p>
<p>The Responses API uses a flattened tool schema.</p>
<pre><code>{
  "type": "function",
  "name": "...",
  "description": "..",
  "parameters": {
    "type": "object",
    "properties": {
      "a": {"type": "integer"},
      "b": {"type": "integer"}
    },
    "required": ["a", "b"]
  }
}</code></pre>
<p>If you pass your wrapped version (function: {…}) to responses.create, you’ll get a schema validation error.</p>
<ul>
<li>Chat Completions treats tools as message-level actions → nested function</li>
<li>Responses API treats tools as first-class model capabilities → flattened schema</li>
<li>The Responses API also supports non-function tools (web search, file search, computer use), which drove the redesign</li>
</ul>
<p>If you want maximum forward compatibility: - Use the flattened format - Even when working with Chat Completions, it’s easy to convert</p>
<hr>
<section id="get_tools_schemas_and_functions" class="level3">
<h3 class="anchored" data-anchor-id="get_tools_schemas_and_functions">get_tools_schemas_and_functions</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_tools_schemas_and_functions(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    funcs:Sequence, responsesAPIFormat:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Get a dictionary of json schemas and callable functions which can be used for native tool calling.</em></p>
<div id="2a726307-f8c0-4297-9e83-d902e463ab9a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>get_tools_schemas_and_functions([add, multiply])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'add': ({'type': 'function',
   'function': {'name': 'add',
    'description': 'Add two numbers\n\nReturns:\n- type: integer',
    'parameters': {'type': 'object',
     'properties': {'a': {'type': 'integer',
       'description': 'The first number'},
      'b': {'type': 'integer', 'description': 'The second number'}},
     'required': ['a', 'b']}}},
  &lt;function __main__.add(a: int, b: int) -&gt; int&gt;),
 'multiply': ({'type': 'function',
   'function': {'name': 'multiply',
    'description': 'Multiply two numbers\n\nReturns:\n- type: integer',
    'parameters': {'type': 'object',
     'properties': {'a': {'type': 'integer',
       'description': 'The first number'},
      'b': {'type': 'integer', 'description': 'The second number'}},
     'required': ['a', 'b']}}},
  &lt;function __main__.multiply(a: int, b: int) -&gt; int&gt;)}</code></pre>
</div>
</div>
<div id="bf2e99c9-0e59-484e-934a-8a1029656fba" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>get_tools_schemas_and_functions([add, multiply], responsesAPIFormat<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'add': ({'type': 'function',
   'name': 'add',
   'description': 'Add two numbers\n\nReturns:\n- type: integer',
   'parameters': {'type': 'object',
    'properties': {'a': {'type': 'integer', 'description': 'The first number'},
     'b': {'type': 'integer', 'description': 'The second number'}},
    'required': ['a', 'b']}},
  &lt;function __main__.add(a: int, b: int) -&gt; int&gt;),
 'multiply': ({'type': 'function',
   'name': 'multiply',
   'description': 'Multiply two numbers\n\nReturns:\n- type: integer',
   'parameters': {'type': 'object',
    'properties': {'a': {'type': 'integer', 'description': 'The first number'},
     'b': {'type': 'integer', 'description': 'The second number'}},
    'required': ['a', 'b']}},
  &lt;function __main__.multiply(a: int, b: int) -&gt; int&gt;)}</code></pre>
</div>
</div>
<hr>
</section>
<section id="tools" class="level3">
<h3 class="anchored" data-anchor-id="tools">Tools</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Tools(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    python_functions:Sequence, responsesAPIFormat:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>“Execute tools implemented as python functions with Large Language Models.</em> The python functions must be fully documented: - type annotations are mandatory on all parameters and on the return type - a docstring after the function definition is mandatory - a descriptive comment after each parameter and the return type is also mandatory - the expected format is: one parameter by line, a traditional python comment at the end of the line</p>
<hr>
</section>
<section id="toolexecutionerror" class="level3">
<h3 class="anchored" data-anchor-id="toolexecutionerror">ToolExecutionError</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ToolExecutionError(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    args:VAR_POSITIONAL, kwargs:VAR_KEYWORD</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Raised when a tool cannot be executed safely.</em></p>
<div id="90404ad5-ebac-40e1-ae45-7ba79a99a595" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T07:55:09.567365Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T07:55:09.567252Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T07:55:09.570063Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T07:55:09.569623Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T07:55:09.567356Z&quot;}}" data-execution_count="497">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tools <span class="op">=</span> Tools([add,multiply])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cd3ae44d-e38f-4f2d-91a2-6759c220394c" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T07:55:10.301267Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T07:55:10.301191Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T07:55:10.303703Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T07:55:10.303327Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T07:55:10.301260Z&quot;}}" data-execution_count="498">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tools.has_tool(<span class="st">"add"</span>), tools.has_tool(<span class="st">"toto"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="498">
<pre><code>(True, False)</code></pre>
</div>
</div>
<div id="da93dfce-b521-4cf4-91d5-36c489fed386" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>tools.get_schemas()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>[{'type': 'function',
  'function': {'name': 'add',
   'description': 'Add two numbers\n\nReturns:\n- type: integer',
   'parameters': {'type': 'object',
    'properties': {'a': {'type': 'integer', 'description': 'The first number'},
     'b': {'type': 'integer', 'description': 'The second number'}},
    'required': ['a', 'b']}}},
 {'type': 'function',
  'function': {'name': 'multiply',
   'description': 'Multiply two numbers\n\nReturns:\n- type: integer',
   'parameters': {'type': 'object',
    'properties': {'a': {'type': 'integer', 'description': 'The first number'},
     'b': {'type': 'integer', 'description': 'The second number'}},
    'required': ['a', 'b']}}}]</code></pre>
</div>
</div>
<div id="12d29f37-9138-46f6-946f-64f0a9e2a87f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tools.get_schema(<span class="st">"add"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'type': 'function',
 'function': {'name': 'add',
  'description': 'Add two numbers\n\nReturns:\n- type: integer',
  'parameters': {'type': 'object',
   'properties': {'a': {'type': 'integer', 'description': 'The first number'},
    'b': {'type': 'integer', 'description': 'The second number'}},
   'required': ['a', 'b']}}}</code></pre>
</div>
</div>
<div id="ac1bcb66-7762-4869-8911-3f8dbac92e85" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>tools.get_functions()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>[&lt;function __main__.add(a: int, b: int) -&gt; int&gt;,
 &lt;function __main__.multiply(a: int, b: int) -&gt; int&gt;]</code></pre>
</div>
</div>
<div id="8b98d00a-8c88-4dc3-a290-1b19739c59aa" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>tools.get_function(<span class="st">"add"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;function __main__.add(a: int, b: int) -&gt; int&gt;</code></pre>
</div>
</div>
<div id="04a8b645-d905-46a8-a522-f9517bc4859f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>tools.call(<span class="st">"add"</span>, {<span class="st">"a"</span>: <span class="dv">1</span>, <span class="st">"b"</span>: <span class="dv">2</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>3</code></pre>
</div>
</div>
</section>
</section>
<section id="images" class="level2">
<h2 class="anchored" data-anchor-id="images">Images</h2>
<hr>
<section id="images-1" class="level3">
<h3 class="anchored" data-anchor-id="images-1">Images</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Images(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    image:Union<span class="op">=</span><span class="va">None</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Initialize self. See help(type(self)) for accurate signature.</em></p>
<div id="b6411150-2a98-48a5-8fc4-7707d4d72c76" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> Images(<span class="st">"puppy.jpg"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> image <span class="kw">in</span> images.get_base64_data():</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(image[:<span class="dv">50</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQ</code></pre>
</div>
</div>
<div id="6cfad55c-50f9-46c5-9f78-5bd42ce528a4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> Images(<span class="st">"https://i.pinimg.com/736x/3c/fa/a2/3cfaa27aeff09adff6c2e6fbc5fd0dfa.jpg"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> image <span class="kw">in</span> images.get_base64_data():</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(image[:<span class="dv">50</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAYEBQYFBAYGBQYHBw</code></pre>
</div>
</div>
<div id="db675b20-d121-4a43-a33e-6d5870dfc13b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> image,is_url <span class="kw">in</span> images.get_base64_data_or_url():</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(image[:<span class="dv">50</span>], is_url)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>https://i.pinimg.com/736x/3c/fa/a2/3cfaa27aeff09ad True</code></pre>
</div>
</div>
<div id="9937f47b-a725-4c47-bc75-85d94df8e020" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>image_bytes <span class="op">=</span> Path(<span class="st">"puppy.jpg"</span>).read_bytes()</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> Images(image_bytes)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> image <span class="kw">in</span> images.get_base64_data():</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(image[:<span class="dv">50</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQ</code></pre>
</div>
</div>
<div id="04173996-e204-4a97-954b-4868ea80d077" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>images.add_web_url(<span class="st">"https://i.pinimg.com/736x/3c/fa/a2/3cfaa27aeff09adff6c2e6fbc5fd0dfa.jpg"</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> image,is_url <span class="kw">in</span> images.get_base64_data_or_url():</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(image[:<span class="dv">50</span>], is_url)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQ False
https://i.pinimg.com/736x/3c/fa/a2/3cfaa27aeff09ad True</code></pre>
</div>
</div>
</section>
</section>
<section id="model-client" class="level2">
<h2 class="anchored" data-anchor-id="model-client">Model client</h2>
<hr>
<section id="modelclient" class="level3">
<h3 class="anchored" data-anchor-id="modelclient">ModelClient</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ModelClient(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    model:<span class="bu">str</span>, context_size:Optional<span class="op">=</span><span class="va">None</span>, base_url:Optional<span class="op">=</span><span class="va">None</span>, api_key:Optional<span class="op">=</span><span class="va">None</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Helper class that provides a standard way to create an ABC using</em> inheritance.</p>
</section>
<section id="ollama-model-client" class="level3">
<h3 class="anchored" data-anchor-id="ollama-model-client">ollama model client</h3>
<hr>
</section>
<section id="ollamamodelclient" class="level3">
<h3 class="anchored" data-anchor-id="ollamamodelclient">OllamaModelClient</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> OllamaModelClient(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    model:<span class="bu">str</span>, context_size:<span class="bu">int</span><span class="op">=</span><span class="dv">32768</span>, <span class="co"># This is the default value for the ollama server in wordslab-notebooks</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    base_url:<span class="bu">str</span><span class="op">=</span><span class="st">'http://localhost:11434'</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    api_key:Optional<span class="op">=</span><span class="va">None</span>, <span class="co"># If not provided, the optional key will be pulled from WordslabEnv</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Helper class that provides a standard way to create an ABC using</em> inheritance.</p>
<div id="3d77f8e6-8322-4da8-830e-b2b26ccec705" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> env.default_model_code</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>model</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'qwen3:30b'</code></pre>
</div>
</div>
<div id="05e3a5f1-6fe0-4dff-9a5a-8ac348f7d012" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>oclient <span class="op">=</span> OllamaModelClient(model, context_size<span class="op">=</span><span class="dv">65000</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>ollama: loading model qwen3:30b with context size 65000 ... ok</code></pre>
</div>
</div>
<div id="0795c383-f0a7-4d3a-ac1c-c7a19799ffc8" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"In one sentence: why is the sky blue?"</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>oclient(user_prompt<span class="op">=</span>prompt, think<span class="op">=</span><span class="va">True</span>, max_new_tokens<span class="op">=</span><span class="dv">1000</span>, seed<span class="op">=</span><span class="dv">42</span>, temperature<span class="op">=</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 205 words</p>
</blockquote>
<p>Sunlight scatters in Earth’s atmosphere, with shorter blue wavelengths scattering more effectively than other colors, causing the sky to appear blue.</p>
</div>
</div>
<div id="63593e13-4dd5-43ab-91c9-044ce9486a8c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>system <span class="op">=</span> <span class="st">"Talk like a pirate"</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"In one sentence: why is the sky blue?"</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>oclient(system_prompt<span class="op">=</span>system, user_prompt<span class="op">=</span>prompt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 264 words</p>
</blockquote>
<p>Arrr! The sun’s light scatters in the air, and the short blue waves bounce all about, making the sky shine like a doubloon!</p>
</div>
</div>
<div id="8c3233b9-0f2d-45cc-bf5f-db2eb3c822d2" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"In one sentence: why is the sky blue?"</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>assistant <span class="op">=</span> <span class="st">"Once upon a time "</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>oclient(user_prompt<span class="op">=</span>prompt, assistant_prefill<span class="op">=</span>assistant)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Once upon a time 200 years ago, a scientist named Rayleigh discovered that the sky is blue because of a phenomenon called Rayleigh scattering, where the atmosphere scatters shorter blue wavelengths of sunlight more than longer red wavelengths, making the sky appear blue during the day.</p>
</div>
</div>
<div id="3848807c-8298-4db2-ad92-9a8737fe7c8a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"Using only the provided tools to make no mistake, what is (11545468+78782431)*418742?"</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>tools <span class="op">=</span> Tools([add, multiply])</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>oclient(user_prompt<span class="op">=</span>prompt, tools<span class="op">=</span>tools, think<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 2925 words</p>
</blockquote>
<blockquote class="blockquote">
<p>[Tool call] … <code>add</code> returned <code>90327899</code></p>
</blockquote>
<blockquote class="blockquote">
<p>[Tool call] … <code>multiply</code> returned <code>37824085083058</code></p>
</blockquote>
<blockquote class="blockquote">
<p>[Thinking] … thought in 116 words</p>
</blockquote>
<p>The result of <span class="math inline">\((11545468 + 78782431) \times 418742\)</span> is <strong>37824085083058</strong>.</p>
</div>
</div>
<div id="c0235ff5-8dcd-4676-b397-aa2594f06e8e" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T08:00:39.037355Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T08:00:39.037201Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T08:00:39.041102Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T08:00:39.040494Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T08:00:39.037346Z&quot;}}" data-execution_count="504">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Book:</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, title: <span class="bu">str</span>, pages: <span class="bu">int</span>):</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.title <span class="op">=</span> title</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pages <span class="op">=</span> pages</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>):</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Book Title : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>title<span class="sc">}</span><span class="ch">\n</span><span class="ss">Number of Pages : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>pages<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>book <span class="op">=</span> Book(<span class="st">"War and Peace"</span>, <span class="dv">950</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>book</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="504">
<pre><code>Book Title : War and Peace
Number of Pages : 950</code></pre>
</div>
</div>
<div id="4330a393-73b1-4185-850a-cfaca0cb7497" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T08:00:40.073672Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T08:00:40.073593Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T08:00:40.077186Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T08:00:40.076480Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T08:00:40.073665Z&quot;}}" data-execution_count="505">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_page(book: Book, <span class="co"># The book to find the halfway point of</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>              percent: <span class="bu">int</span>, <span class="co"># Percent of a book to read to, e.g. halfway == 50, </span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"The page number corresponding to `percent` completion of a book"</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">round</span>(book.pages <span class="op">*</span> (percent <span class="op">/</span> <span class="fl">100.0</span>))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>find_page(book, <span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="505">
<pre><code>475</code></pre>
</div>
</div>
<div id="439900ea-e162-45e4-be13-a95b6b704854" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-01-11T08:02:09.361763Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-01-11T08:02:09.361679Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-01-11T08:02:22.677144Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-01-11T08:02:22.676590Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2026-01-11T08:02:09.361756Z&quot;}}" data-execution_count="506">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"Using only the provided tools to make no mistake, how many pages do I have to read to get halfway through my 950 page copy of War and Peace"</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>tools <span class="op">=</span> Tools([find_page])</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>oclient(user_prompt<span class="op">=</span>prompt, tools<span class="op">=</span>tools, think<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 285 words</p>
</blockquote>
<blockquote class="blockquote">
<p>[Tool call] … <code>find_page</code> returned <code>475</code></p>
</blockquote>
<blockquote class="blockquote">
<p>[Thinking] … thought in 94 words</p>
</blockquote>
<p>To reach the halfway point of your 950-page copy of <em>War and Peace</em>, you need to read <strong>475 pages</strong>.</p>
</div>
</div>
<p><strong>Images</strong></p>
<div id="6bc8b1c4-ac44-4a96-a1ff-b3910add630a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="st">"devstral-small-2:24b"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="03bb6eb3-753b-40b4-bb26-098d973a38d4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>oclient <span class="op">=</span> OllamaModelClient(model)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>ollama: loading model devstral-small-2:24b with context size 32768 ... ok</code></pre>
</div>
</div>
<div id="0bd129e4-0ae8-4916-8681-b7e6b581d228" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"Describe this picture in a structured way"</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> Images(<span class="st">"puppy.jpg"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>oclient(user_prompt<span class="op">=</span>prompt, user_images<span class="op">=</span>images)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Here is a structured description of the image:</p>
<ol type="1">
<li><strong>Subject</strong>:
<ul>
<li>A young Golden Retriever puppy.</li>
</ul></li>
<li><strong>Appearance</strong>:
<ul>
<li>Coat: Light golden fur, slightly wavy and fluffy.</li>
<li>Eyes: Dark, round, and expressive.</li>
<li>Ears: Floppy and medium-sized.</li>
<li>Mouth: Open slightly, showing a playful expression.</li>
<li>Body: Compact and sturdy, typical of a puppy.</li>
</ul></li>
<li><strong>Action</strong>:
<ul>
<li>The puppy appears to be in motion, possibly running or playing.</li>
<li>Front paws are lifted off the ground, suggesting movement.</li>
</ul></li>
<li><strong>Background</strong>:
<ul>
<li>Outdoor setting with a grassy field.</li>
<li>Blurred background, indicating focus on the puppy.</li>
</ul></li>
<li><strong>Lighting and Mood</strong>:
<ul>
<li>Natural daylight, likely during the day.</li>
<li>Warm and cheerful atmosphere, enhanced by the puppy’s joyful expression.</li>
</ul></li>
<li><strong>Additional Details</strong>:
<ul>
<li>A leash is visible around the puppy’s neck, suggesting it might be on a walk or playtime.</li>
<li>The grass is slightly tall and appears well-maintained.</li>
</ul></li>
</ol>
<p>This structured description captures the key elements of the image in a clear and organized manner.</p>
</div>
</div>
<div id="b03ed97d-e80f-43a2-8257-8ef95b7c5265" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"Describe both images in a short paragraph"</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>images.add_web_url(<span class="st">"https://i.pinimg.com/736x/3c/fa/a2/3cfaa27aeff09adff6c2e6fbc5fd0dfa.jpg"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>oclient(user_prompt<span class="op">=</span>prompt, user_images<span class="op">=</span>images)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>The first image shows a golden retriever puppy standing in a grassy field, looking directly at the camera with a happy expression. The puppy has a fluffy coat and appears to be in motion, possibly running or playing. The second image features the same golden retriever puppy sitting in a grassy field during sunset, with the sun visible in the background. The puppy is looking up and to the side, also with a joyful expression, and its fur is illuminated by the warm, golden light of the setting sun. Both images capture the playful and cheerful nature of the puppy in different settings.</p>
</div>
</div>
<p><strong>Structured outputs</strong></p>
<div id="826c9ce4-5bf5-4225-bcb2-7f098edaa340" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Pet(BaseModel):</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    model_config <span class="op">=</span> ConfigDict(extra<span class="op">=</span><span class="st">"forbid"</span>)    </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    animal: <span class="bu">str</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    color: <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PetList(BaseModel):</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    model_config <span class="op">=</span> ConfigDict(extra<span class="op">=</span><span class="st">"forbid"</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    pets: <span class="bu">list</span>[Pet]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="58dd4688-09b5-4f8b-9810-eedb668f84f2" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"I have two cats named Luna and Loki, Luna is 2 years old an yellow, Loki is 2 years older and the same color as the sky"</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>oclient(user_prompt<span class="op">=</span>prompt, output_model<span class="op">=</span>PetList)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>oclient.response</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>{ “pets”: [ { “name”: “Luna”, “animal”: “cat”, “age”: 2, “color”: “yellow” }, { “name”: “Loki”, “animal”: “cat”, “age”: 4, “color”: “blue” } ] }</p>
</div>
<div class="cell-output cell-output-display">
<pre><code>PetList(pets=[Pet(name='Luna', animal='cat', age=2, color='yellow'), Pet(name='Loki', animal='cat', age=4, color='blue')])</code></pre>
</div>
</div>
<p><strong>Web search</strong></p>
<div id="a0b5c40d-6a70-425a-ada1-5c079b81124a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> env.default_model_code</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>oclient <span class="op">=</span> OllamaModelClient(model, context_size<span class="op">=</span><span class="dv">65000</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>ollama: loading model qwen3:30b with context size 65000 ... ok</code></pre>
</div>
</div>
<div id="79e33278-fcb0-434a-9ee2-259ddb878a0c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"what are the features in the latest github relase of ollama"</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>oclient(user_prompt<span class="op">=</span>prompt, think<span class="op">=</span><span class="va">True</span>, web_search<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 357 words</p>
</blockquote>
<blockquote class="blockquote">
<p>[Tool call] … <code>web_search</code> returned <code>results=[WebSearchResult(content='Releases ·oll...</code></p>
</blockquote>
<blockquote class="blockquote">
<p>[Thinking] … thought in 585 words</p>
</blockquote>
<p>The latest GitHub release of Ollama is <strong>v0.14.0-rc2</strong> (pre-release), which includes the following key features:</p>
<section id="new-features" class="level3">
<h3 class="anchored" data-anchor-id="new-features">New Features:</h3>
<ol type="1">
<li><strong>Experimental CLI</strong>:
<ul>
<li><code>ollama run --experimental</code> now includes an <strong>agent loop</strong> and the <code>bash</code> tool for interactive workflows.</li>
</ul></li>
<li><strong>Anthropic API Compatibility</strong>:
<ul>
<li>Support for the <code>/v1/messages</code> API endpoint (compatible with Anthropic models).</li>
</ul></li>
<li><strong>Model Version Requirements</strong>:
<ul>
<li>New <code>REQUIRES</code> command in <code>Modelfile</code> to declare required Ollama version for a model.</li>
</ul></li>
<li><strong>VRAM Improvements</strong>:
<ul>
<li>Fixes for integer underflow on low VRAM systems during memory estimation.<br>
</li>
<li>More accurate VRAM measurements for AMD iGPUs.</li>
</ul></li>
<li><strong>App Enhancements</strong>:
<ul>
<li>Ollama’s app now highlights Swift source code.<br>
</li>
<li>Improved error handling for embeddings returning <code>NaN</code> or <code>-Inf</code>.</li>
</ul></li>
<li><strong>Linux Install Optimization</strong>:
<ul>
<li>Linux install bundles now use <code>zst</code> compression (smaller downloads).</li>
</ul></li>
<li><strong>Experimental Image Generation</strong>:
<ul>
<li>New support for image generation models via MLX (experimental).</li>
</ul></li>
</ol>
<hr>
</section>
<section id="notes" class="level3">
<h3 class="anchored" data-anchor-id="notes">Notes:</h3>
<ul>
<li><strong>Stable Release</strong>: The latest <em>stable</em> release is <strong>v0.13.5</strong> (Dec 18, 2025), which added support for <code>bert</code> architecture models, DeepSeek-V3.1 tool parsing, and Google’s <code>FunctionGemma</code> model.</li>
<li><strong>Pre-release</strong>: v0.14.0-rc2 is the most recent release candidate, but it is <strong>not yet finalized</strong> (marked as “Pre-release” on GitHub).</li>
</ul>
<p>For the most up-to-date features, check the <a href="https://github.com/ollama/ollama/releases">Ollama GitHub Releases page</a>.</p>
</section>
</div>
</div>
<div id="552baf4e-4bce-405a-b35c-1966b1cb7c67" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"read https://docs.ollama.com/capabilities/web-search and summarize in one sentence what tools i can use to implement a search agent with ollama"</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>oclient(user_prompt<span class="op">=</span>prompt, think<span class="op">=</span><span class="va">True</span>, web_search<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 424 words</p>
</blockquote>
<blockquote class="blockquote">
<p>[Tool call] … <code>web_fetch</code> returned <code>title='Web search - Ollama' content='Web search...</code></p>
</blockquote>
<blockquote class="blockquote">
<p>[Thinking] … thought in 224 words</p>
</blockquote>
<p>Ollama provides the <code>web_search</code> and <code>web_fetch</code> APIs as core tools to implement a search agent, enabling model-based web queries and page content retrieval for accurate, up-to-date information.</p>
</div>
</div>
</section>
<section id="openrouter-chat-client" class="level3">
<h3 class="anchored" data-anchor-id="openrouter-chat-client">openrouter chat client</h3>
<div id="7c4efe62-a7e2-426d-9777-85e7584eaa6f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>env <span class="op">=</span> WordslabEnv()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="c8c0a058-d4df-4063-9870-52f47f4fd691" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>, api_key<span class="op">=</span>env.cloud_openrouter_api_key)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="27a0c9eb-6c47-4a23-b8be-eba2fb8923c8" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="st">"google/gemini-3-flash-preview"</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span> [{<span class="st">'role'</span>: <span class="st">'user'</span>, <span class="st">'content'</span>: <span class="st">'What is the smallest number palindrome greater than 130?'</span>}]</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>stream <span class="op">=</span> client.chat.completions.create(model<span class="op">=</span>model, messages<span class="op">=</span>messages, stream<span class="op">=</span><span class="va">True</span>, extra_body<span class="op">=</span>{<span class="st">"reasoning"</span>: {<span class="st">"enabled"</span>: <span class="va">True</span>}})</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chunk <span class="kw">in</span> stream:</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> chunk.choices[<span class="dv">0</span>].delta</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(delta)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>ChoiceDelta(content='', function_call=None, refusal=None, role='assistant', tool_calls=None, reasoning="**Identifying a Solution**\n\nI've homed in on the core challenge: pinpointing the smallest palindrome exceeding 130. The constraints are clear, and I'm strategizing how to efficiently generate and validate candidate numbers. I am starting by looking at the numbers directly after 130.\n\n\n", reasoning_details=[{'index': 0, 'type': 'reasoning.text', 'text': "**Identifying a Solution**\n\nI've homed in on the core challenge: pinpointing the smallest palindrome exceeding 130. The constraints are clear, and I'm strategizing how to efficiently generate and validate candidate numbers. I am starting by looking at the numbers directly after 130.\n\n\n", 'format': 'google-gemini-v1'}], annotations=[])
ChoiceDelta(content='', function_call=None, refusal=None, role='assistant', tool_calls=None, reasoning="**Determining the Answer**\n\nI've directly confirmed that 131 fulfills all criteria. No need to look further: it's the smallest palindrome that's larger than 130. I have confirmed that this number satisfies the relevant constraints, and I consider this the final result.\n\n\n", reasoning_details=[{'index': 0, 'type': 'reasoning.text', 'text': "**Determining the Answer**\n\nI've directly confirmed that 131 fulfills all criteria. No need to look further: it's the smallest palindrome that's larger than 130. I have confirmed that this number satisfies the relevant constraints, and I consider this the final result.\n\n\n", 'format': 'google-gemini-v1'}], annotations=[])
ChoiceDelta(content='The smallest palindrome number greater than 130 is **131**.\n\nA palindrome is a number that reads the same forwards and backwards. Since 131 reads as "1-3-1" in both directions and is the very next integer after 130 that follows this rule, it is the', function_call=None, refusal=None, role='assistant', tool_calls=None, reasoning=None, reasoning_details=[], annotations=[])
ChoiceDelta(content=' correct answer.', function_call=None, refusal=None, role='assistant', tool_calls=None, reasoning=None, reasoning_details=[{'index': 0, 'type': 'reasoning.encrypted', 'data': 'CiIBjz1rXx1wDxrqK4iEiYLEfo4BC0TbRcSKhvVO48q1Ge9HCmgBjz1rX93sCp42z//JmKxDWvv3kYw3fkxVXSsbAkJ9/OsR5GxzvX3NRxq1GmWU6PzNix6QQ9aFfZmZqEwc3u/anTQiQwCLH+N77Rh7vLxAvr0VCSVLJ83rqljqFi93fMyjr0pjX9OE5gpZAY89a1/PpcHwJxd6EjqwLvSFlebK6nVnQDn90G86P3/tRXy2sZxYogVEh44KsQZ4r+0B/2ClLCNJf+EvIBCEs6zXHTMLx6AJIDU6SumITgIppnPdYWwoUuoKeAGPPWtfeJ7lICOOm3dtb2YzhnJiSGPI5m96K1G/2lwo04wSze+2vbS0FGKQnAYkOR21tRqDV+JGOKon/MdNhKTfjVd+TNPUfcQCNQh+dmlVajIJRyql4sYeYSg6Wz+AA0A0dNv6GWIKaXmKCBS087b+FUT1ZMBuSgpgAY89a1+ZR6BSJsZTg5YUGg11YzeDIsaqhs+FvHy/1XB4uPp3SW+mqIfysxta4e4y7oeOuTNButgOKnDeaJfPG8VSjSh0lT0R1dHEifHAIFbiF2IKQJXW07ns6L1E9syYCn8Bjz1rXwn3gb5Q8D+qPic5yZTziFidiTxpKH3uhjyYqTrZR8hRGnmVVk05a8E/5J81UkxOevZ5yAxLiFCdimXI5yr7LriL4bDiHajdSXVxdOiKHzb6Pqx3MiLySYUt1ToD3XUAIZQBmfDVw+Qd6SQdagvsi86NKMv793xrUMlECroBAY89a18BugGYHx3fQYckccMCOS91fxOFH7hBj24O746sJhbrBMLmQSPk0du421Zmd8Lx1Ns21/SwpHCfnQ3AEA9BZ9XfahR51tE96d9DjXO7kMsgGDPoLsDApRTnRenQbPJnpXqoQYZbsnE/H1B6Tb4wcE5xJpcBKLRvXhg+c14T5NYpFEcE3dHaNUH6xXj68ZLBl2Q5FtzqOd6tyxSLRhQJfa00yDFnpn+Lbo0zLSRqbP+ovAWIq79BCpMBAY89a1/ENqGNTYpM7VJzpDZus8SoUClqlwaOwrOOHYfz6NaB3CP3coADgPnltU0hZrGfE0w4xHdM85pJaT/2HHv9GQH2o2R4nAGwT3KInxBeAVo0TtE2M9aN78wDhveiyqPUsHO1uybcRorF3uUwEIAT8NX93ykz3FwcVZvO/aYtE9A7mVN4qYgXfjvIFwIBjFJs', 'format': 'google-gemini-v1'}], annotations=[])
ChoiceDelta(content='', function_call=None, refusal=None, role='assistant', tool_calls=None)</code></pre>
</div>
</div>
<div id="ca7830b3-686f-4152-a957-483cd26428c4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span> [{<span class="st">'role'</span>: <span class="st">'user'</span>, <span class="st">'content'</span>: <span class="st">"Using only the provided tools to make no mistake, what is (11545468+78782431)*418742?"</span>}]</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>tools <span class="op">=</span> Tools([add, multiply])</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>stream <span class="op">=</span> client.chat.completions.create(model<span class="op">=</span>model, messages<span class="op">=</span>messages, tools <span class="op">=</span> tools.get_schemas(), stream<span class="op">=</span><span class="va">True</span>, extra_body<span class="op">=</span>{<span class="st">"reasoning"</span>: {<span class="st">"enabled"</span>: <span class="va">True</span>}})</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chunk <span class="kw">in</span> stream:</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> chunk.choices[<span class="dv">0</span>].delta</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(delta)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>ChoiceDelta(content='', function_call=None, refusal=None, role='assistant', tool_calls=None, reasoning="**Calculating the Total Sum**\n\nI'm currently focused on the first step: summing the initial numbers. I've successfully employed the `add` function, and the intermediate result is now readily available. It's a significant figure, and I'm ready to proceed to the next stage after a brief review.\n\n\n", reasoning_details=[{'index': 0, 'type': 'reasoning.text', 'text': "**Calculating the Total Sum**\n\nI'm currently focused on the first step: summing the initial numbers. I've successfully employed the `add` function, and the intermediate result is now readily available. It's a significant figure, and I'm ready to proceed to the next stage after a brief review.\n\n\n", 'format': 'google-gemini-v1'}], annotations=[])
ChoiceDelta(content='', function_call=None, refusal=None, role='assistant', tool_calls=None, reasoning="**Initiating Multiplication Operations**\n\nI've got the total sum from the previous stage, a substantial number. Now, the plan is to multiply this sum by 418,742. I'm preparing to invoke the `multiply` function, and I'm ready to observe the final result soon.\n\n\n", reasoning_details=[{'index': 0, 'type': 'reasoning.text', 'text': "**Initiating Multiplication Operations**\n\nI've got the total sum from the previous stage, a substantial number. Now, the plan is to multiply this sum by 418,742. I'm preparing to invoke the `multiply` function, and I'm ready to observe the final result soon.\n\n\n", 'format': 'google-gemini-v1'}], annotations=[])
ChoiceDelta(content=None, function_call=None, refusal=None, role='assistant', tool_calls=[ChoiceDeltaToolCall(index=0, id='tool_add_bxj7qiqYR0YykpEmfzoC', function=ChoiceDeltaToolCallFunction(arguments='{"b":78782431,"a":11545468}', name='add'), type='function')], reasoning=None, reasoning_details=[{'index': 0, 'id': 'tool_add_bxj7qiqYR0YykpEmfzoC', 'type': 'reasoning.encrypted', 'data': 'CiQBjz1rX1bExybTM6VtK0kASX6FTxfBBwyi932MRRrEuYtvkdsKUQGPPWtfr55kYc/lU0ZhVkHjN6wZ74W1LVMPXkSF3tFEoDwQtfzpuzYnV7xzD1qz5CnzNvZm5i9eY0qQKJhzhXAC3FTmjZ6D2OdODRvDX7uUGwo0AY89a1/zpxr22ksclwFiLTfaAWYr57nJPyB5mHc8h6PIE3uu5ggyUE4VsZoaqVxv2q03jQp6AY89a187jC4w08IR8/fDOrJwQEOLQO5yNEUlQphL8lckJvAltj2ULGXY06WBV8yi1n3YGUZEAgLU4ihc/o8+/nVuk+OnKvicbju9XY82ZeP35D8yFVPEFMyHifVptjjPry8rCpr4N84UipqVfc0rmtFPBbE6+6TTFIUKaQGPPWtf6XkgaitG1kvzHAeW+I55A2dWbhyG/8Z15RjCkArCtKMEEf1r9v7G0ke7kNuIW8jhHF5H/wm/20m69zrsCp1obV+jbZR8T6lb3Km4EXJOldkm/U1lsHZRI8Lp2mkzreV1QbkqHwo2AY89a1/PJ5AClPojS2Y4jbD3oN8tblRCmUNTysi69fLd/4tqapYHz4CLAo+LMhFvzLN9N4qZ', 'format': 'google-gemini-v1'}], annotations=[])
ChoiceDelta(content='', function_call=None, refusal=None, role='assistant', tool_calls=None)</code></pre>
</div>
</div>
<p><strong>Openrouter API reference</strong></p>
<p>Note: as of January 2026 - the OpenAI-compatible Responses API (Beta) is in beta stage and may have breaking changes. Use with caution in production environments.</p>
<p>=&gt; we will use the competions API for now</p>
<p>https://openrouter.ai/docs/api/reference/overview</p>
<p>REQUEST SCHEMA</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb79"><pre class="sourceCode typescript code-with-copy"><code class="sourceCode typescript"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Definitions of subtypes are below</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Request <span class="op">=</span> {</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Either "messages" or "prompt" is required</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">?:</span> Message[]<span class="op">;</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  prompt<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// If "model" is unspecified, uses the user's default</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  model<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span> <span class="co">// See "Supported Models" section</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Allows to force the model to produce specific output format.</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// See models page and note on this docs page for which models support it.</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  response_format<span class="op">?:</span> { type<span class="op">:</span> <span class="st">'json_object'</span> }<span class="op">;</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  stop<span class="op">?:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  stream<span class="op">?:</span> <span class="dt">boolean</span><span class="op">;</span> <span class="co">// Enable streaming</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// See LLM Parameters (openrouter.ai/docs/api/reference/parameters)</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  max_tokens<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Range: [1, context_length)</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  temperature<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Range: [0, 2]</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tool calling</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Will be passed down as-is for providers implementing OpenAI's interface.</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// For providers with custom interfaces, we transform and map the properties.</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Otherwise, we transform the tools into a YAML template. The model responds with an assistant message.</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">// See models supporting tool calling: openrouter.ai/models?supported_parameters=tools</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>  tools<span class="op">?:</span> Tool[]<span class="op">;</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>  tool_choice<span class="op">?:</span> ToolChoice<span class="op">;</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Advanced optional parameters</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>  seed<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Integer only</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>  top_p<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Range: (0, 1]</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>  top_k<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Range: [1, Infinity) Not available for OpenAI models</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>  frequency_penalty<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Range: [-2, 2]</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>  presence_penalty<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Range: [-2, 2]</span></span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>  repetition_penalty<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Range: (0, 2]</span></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>  logit_bias<span class="op">?:</span> { [key<span class="op">:</span> <span class="dt">number</span>]<span class="op">:</span> <span class="dt">number</span> }<span class="op">;</span></span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>  top_logprobs<span class="op">:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Integer only</span></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>  min_p<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Range: [0, 1]</span></span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>  top_a<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Range: [0, 1]</span></span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Reduce latency by providing the model with a predicted output</span></span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">// https://platform.openai.com/docs/guides/latency-optimization#use-predicted-outputs</span></span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>  prediction<span class="op">?:</span> { type<span class="op">:</span> <span class="st">'content'</span><span class="op">;</span> content<span class="op">:</span> <span class="dt">string</span> }<span class="op">;</span></span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">// OpenRouter-only parameters</span></span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">// See "Prompt Transforms" section: openrouter.ai/docs/guides/features/message-transforms</span></span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>  transforms<span class="op">?:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">// See "Model Routing" section: openrouter.ai/docs/guides/features/model-routing</span></span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>  models<span class="op">?:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a>  route<span class="op">?:</span> <span class="st">'fallback'</span><span class="op">;</span></span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">// See "Provider Routing" section: openrouter.ai/docs/guides/routing/provider-selection</span></span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a>  provider<span class="op">?:</span> ProviderPreferences<span class="op">;</span></span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a>  user<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span> <span class="co">// A stable identifier for your end-users. Used to help detect and prevent abuse.</span></span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Debug options (streaming only)</span></span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a>  debug<span class="op">?:</span> {</span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a>    echo_upstream_body<span class="op">?:</span> <span class="dt">boolean</span><span class="op">;</span> <span class="co">// If true, returns the transformed request body sent to the provider</span></span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true" tabindex="-1"></a><span class="co">// Subtypes:</span></span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> TextContent <span class="op">=</span> {</span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="st">'text'</span><span class="op">;</span></span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true" tabindex="-1"></a>  text<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb79-57"><a href="#cb79-57" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb79-58"><a href="#cb79-58" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ImageContentPart <span class="op">=</span> {</span>
<span id="cb79-59"><a href="#cb79-59" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="st">'image_url'</span><span class="op">;</span></span>
<span id="cb79-60"><a href="#cb79-60" aria-hidden="true" tabindex="-1"></a>  image_url<span class="op">:</span> {</span>
<span id="cb79-61"><a href="#cb79-61" aria-hidden="true" tabindex="-1"></a>    url<span class="op">:</span> <span class="dt">string</span><span class="op">;</span> <span class="co">// URL or base64 encoded image data</span></span>
<span id="cb79-62"><a href="#cb79-62" aria-hidden="true" tabindex="-1"></a>    detail<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span> <span class="co">// Optional, defaults to "auto"</span></span>
<span id="cb79-63"><a href="#cb79-63" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb79-64"><a href="#cb79-64" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb79-65"><a href="#cb79-65" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ContentPart <span class="op">=</span> TextContent <span class="op">|</span> ImageContentPart<span class="op">;</span></span>
<span id="cb79-66"><a href="#cb79-66" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Message <span class="op">=</span></span>
<span id="cb79-67"><a href="#cb79-67" aria-hidden="true" tabindex="-1"></a>  <span class="op">|</span> {</span>
<span id="cb79-68"><a href="#cb79-68" aria-hidden="true" tabindex="-1"></a>      role<span class="op">:</span> <span class="st">'user'</span> <span class="op">|</span> <span class="st">'assistant'</span> <span class="op">|</span> <span class="st">'system'</span><span class="op">;</span></span>
<span id="cb79-69"><a href="#cb79-69" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ContentParts are only for the "user" role:</span></span>
<span id="cb79-70"><a href="#cb79-70" aria-hidden="true" tabindex="-1"></a>      content<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> ContentPart[]<span class="op">;</span></span>
<span id="cb79-71"><a href="#cb79-71" aria-hidden="true" tabindex="-1"></a>      <span class="co">// If "name" is included, it will be prepended like this</span></span>
<span id="cb79-72"><a href="#cb79-72" aria-hidden="true" tabindex="-1"></a>      <span class="co">// for non-OpenAI models: `{name}: {content}`</span></span>
<span id="cb79-73"><a href="#cb79-73" aria-hidden="true" tabindex="-1"></a>      name<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb79-74"><a href="#cb79-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-75"><a href="#cb79-75" aria-hidden="true" tabindex="-1"></a>  <span class="op">|</span> {</span>
<span id="cb79-76"><a href="#cb79-76" aria-hidden="true" tabindex="-1"></a>      role<span class="op">:</span> <span class="st">'tool'</span><span class="op">;</span></span>
<span id="cb79-77"><a href="#cb79-77" aria-hidden="true" tabindex="-1"></a>      content<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb79-78"><a href="#cb79-78" aria-hidden="true" tabindex="-1"></a>      tool_call_id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb79-79"><a href="#cb79-79" aria-hidden="true" tabindex="-1"></a>      name<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb79-80"><a href="#cb79-80" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb79-81"><a href="#cb79-81" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> FunctionDescription <span class="op">=</span> {</span>
<span id="cb79-82"><a href="#cb79-82" aria-hidden="true" tabindex="-1"></a>  description<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb79-83"><a href="#cb79-83" aria-hidden="true" tabindex="-1"></a>  name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb79-84"><a href="#cb79-84" aria-hidden="true" tabindex="-1"></a>  parameters<span class="op">:</span> <span class="dt">object</span><span class="op">;</span> <span class="co">// JSON Schema object</span></span>
<span id="cb79-85"><a href="#cb79-85" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb79-86"><a href="#cb79-86" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Tool <span class="op">=</span> {</span>
<span id="cb79-87"><a href="#cb79-87" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="st">'function'</span><span class="op">;</span></span>
<span id="cb79-88"><a href="#cb79-88" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span><span class="op">:</span> FunctionDescription<span class="op">;</span></span>
<span id="cb79-89"><a href="#cb79-89" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb79-90"><a href="#cb79-90" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ToolChoice <span class="op">=</span></span>
<span id="cb79-91"><a href="#cb79-91" aria-hidden="true" tabindex="-1"></a>  <span class="op">|</span> <span class="st">'none'</span></span>
<span id="cb79-92"><a href="#cb79-92" aria-hidden="true" tabindex="-1"></a>  <span class="op">|</span> <span class="st">'auto'</span></span>
<span id="cb79-93"><a href="#cb79-93" aria-hidden="true" tabindex="-1"></a>  <span class="op">|</span> {</span>
<span id="cb79-94"><a href="#cb79-94" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> <span class="st">'function'</span><span class="op">;</span></span>
<span id="cb79-95"><a href="#cb79-95" aria-hidden="true" tabindex="-1"></a>      <span class="kw">function</span><span class="op">:</span> {</span>
<span id="cb79-96"><a href="#cb79-96" aria-hidden="true" tabindex="-1"></a>        name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb79-97"><a href="#cb79-97" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>RESPONSE SCHEMA</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb80"><pre class="sourceCode typescript code-with-copy"><code class="sourceCode typescript"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Definitions of subtypes are below</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Response <span class="op">=</span> {</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Depending on whether you set "stream" to "true" and</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// whether you passed in "messages" or a "prompt", you</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// will get a different output shape</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  choices<span class="op">:</span> (NonStreamingChoice <span class="op">|</span> StreamingChoice <span class="op">|</span> NonChatChoice)[]<span class="op">;</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  created<span class="op">:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// Unix timestamp</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  model<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  object<span class="op">:</span> <span class="st">'chat.completion'</span> <span class="op">|</span> <span class="st">'chat.completion.chunk'</span><span class="op">;</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  system_fingerprint<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span> <span class="co">// Only present if the provider supports it</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Usage data is always returned for non-streaming.</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// When streaming, you will get one usage object at</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// the end accompanied by an empty choices array.</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>  usage<span class="op">?:</span> ResponseUsage<span class="op">;</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co">// If the provider returns usage, we pass it down</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co">// as-is. Otherwise, we count using the GPT-4 tokenizer.</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ResponseUsage <span class="op">=</span> {</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">/** Including images and tools if any */</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  prompt_tokens<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">/** The tokens generated */</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>  completion_tokens<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">/** Sum of the above two fields */</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>  total_tokens<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Subtypes:</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> NonChatChoice <span class="op">=</span> {</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>  finish_reason<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span><span class="op">;</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>  text<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>  error<span class="op">?:</span> ErrorResponse<span class="op">;</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> NonStreamingChoice <span class="op">=</span> {</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>  finish_reason<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span><span class="op">;</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>  native_finish_reason<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span><span class="op">;</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>  message<span class="op">:</span> {</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>    content<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span><span class="op">;</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>    role<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>    tool_calls<span class="op">?:</span> ToolCall[]<span class="op">;</span></span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>  error<span class="op">?:</span> ErrorResponse<span class="op">;</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> StreamingChoice <span class="op">=</span> {</span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>  finish_reason<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span><span class="op">;</span></span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>  native_finish_reason<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span><span class="op">;</span></span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>  delta<span class="op">:</span> {</span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>    content<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span><span class="op">;</span></span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>    role<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>    tool_calls<span class="op">?:</span> ToolCall[]<span class="op">;</span></span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>  error<span class="op">?:</span> ErrorResponse<span class="op">;</span></span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ErrorResponse <span class="op">=</span> {</span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>  code<span class="op">:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// See "Error Handling" section</span></span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a>  message<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">?:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">unknown</span><span class="op">&gt;;</span> <span class="co">// Contains additional error information such as provider details, the raw error message, etc.</span></span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ToolCall <span class="op">=</span> {</span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="st">'function'</span><span class="op">;</span></span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span><span class="op">:</span> FunctionCall<span class="op">;</span></span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
<section id="openroutermodelclient" class="level3">
<h3 class="anchored">OpenRouterModelClient</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> OpenRouterModelClient(</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    model:<span class="bu">str</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    context_size:Optional<span class="op">=</span><span class="va">None</span>, <span class="co"># For OpenRouter this parameter is ignored, we inherit the remote model config</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    base_url:<span class="bu">str</span><span class="op">=</span><span class="st">'https://openrouter.ai/api/v1'</span>,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    api_key:Optional<span class="op">=</span><span class="va">None</span>, <span class="co"># If not provided, the mandatory key will be pulled from WordslabEnv</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Helper class that provides a standard way to create an ABC using</em> inheritance.</p>
<div id="6b9ca97e-bc5b-4d9a-a1cb-6504aa8596ba" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="st">"anthropic/claude-sonnet-4.5"</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>orclient <span class="op">=</span> OpenRouterModelClient(model)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>openrouter: testing model anthropic/claude-sonnet-4.5 ... ok</code></pre>
</div>
</div>
<div id="e6571223-c99d-4a31-8e61-6be1a51a7ce9" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">'Why is the sky blue?'</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>orclient(user_prompt<span class="op">=</span>prompt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>The sky is blue due to a phenomenon called <strong>Rayleigh scattering</strong>.</p>
<p>Here’s how it works:</p>
<ol type="1">
<li><p><strong>Sunlight contains all colors</strong> - White sunlight is actually made up of all the colors of the rainbow (different wavelengths of light).</p></li>
<li><p><strong>Light interacts with the atmosphere</strong> - When sunlight enters Earth’s atmosphere, it collides with gas molecules (mainly nitrogen and oxygen).</p></li>
<li><p><strong>Blue light scatters more</strong> - Shorter wavelengths (blue and violet) scatter much more easily than longer wavelengths (red and orange). Blue light gets scattered in all directions throughout the sky.</p></li>
<li><p><strong>Why not violet?</strong> - Violet scatters even more than blue, but our eyes are more sensitive to blue, and some violet light is absorbed by the upper atmosphere, so we perceive the sky as blue.</p></li>
</ol>
<p><strong>At sunset/sunrise</strong>, the sky turns red/orange because sunlight travels through more atmosphere to reach your eyes, scattering away most of the blue light and leaving the longer red and orange wavelengths visible.</p>
</div>
</div>
<div id="ec48d67b-458d-47c6-8fb1-63e7d03e5a25" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">'Why is the sky blue?'</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>orclient(system_prompt<span class="op">=</span><span class="st">"Talk like a pirate"</span>, user_prompt<span class="op">=</span>prompt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Arrr, ye be askin’ a fine question there, matey!</p>
<p>The sky be blue because of a bit o’ science called “Rayleigh scatterin’,” savvy? When the sun’s light comes sailin’ through our atmosphere, it be carryin’ all the colors o’ the rainbow mixed together, aye.</p>
<p>Now here be the trick - the tiny molecules in the air be like little scallywags that scatter the light in all directions. But the blue light, bein’ shorter and choppier like waves in a storm, gets scattered MORE than the other colors. Red and orange light? Those long wavelengths sail right on through like a ship with the wind at its back!</p>
<p>So when ye look up at the heavens, yer eyes be seein’ all that scattered blue light bouncin’ around the sky from every direction. That be why the whole sky looks blue instead of just where the sun be!</p>
<p>At sunset though, arrr, the light travels through more atmosphere - like a longer voyage across the seas - and all that blue gets scattered away completely, leavin’ only the reds and oranges to paint the sky. Beautiful as a Caribbean sunset, it is!</p>
<p><em>Tips tricorn hat</em></p>
<p>Any more questions for this old sea dog? ⚓</p>
</div>
</div>
<div id="5479d781-99ea-43c6-b60d-fe90327401f3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">'Why is the sky blue?'</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>orclient(user_prompt<span class="op">=</span>prompt, assistant_prefill<span class="op">=</span><span class="st">"Once upon a time "</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Once upon a time in the kingdom of Light, <strong>photons</strong> embarked on a journey from the Sun to Earth. As they traveled through the <strong>atmosphere</strong>, they encountered tiny molecules of nitrogen and oxygen.</p>
<p>These molecules were much smaller than the wavelengths of visible light, which caused something magical called <strong>Rayleigh scattering</strong>. This type of scattering has a special property: it scatters shorter wavelengths (blue and violet light) much more effectively than longer wavelengths (red and orange light) — specifically, shorter wavelengths scatter about 10 times more!</p>
<p>Here’s what happens:</p>
<p>🔵 <strong>Blue light</strong> gets scattered in all directions by air molecules 🟣 <strong>Violet light</strong> scatters even more, but our eyes are less sensitive to it 🔴 <strong>Red/orange light</strong> passes through with less scattering</p>
<p>So when you look up at the sky (away from the Sun), you’re seeing all that scattered blue light coming from every direction. This creates the beautiful blue canopy above us.</p>
<p><strong>Fun fact</strong>: At sunrise and sunset, sunlight travels through more atmosphere to reach your eyes. Most of the blue light gets scattered away before it reaches you, leaving the warm reds and oranges — creating those stunning twilight colors! 🌅</p>
</div>
</div>
<div id="3e01f5da-6f15-40eb-a33f-fcb2579370a1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">'What is the smallest number palindrome greater than 130?'</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>orclient(user_prompt<span class="op">=</span>prompt, think<span class="op">=</span><span class="dv">1024</span>, max_new_tokens<span class="op">=</span><span class="dv">2000</span>, seed<span class="op">=</span><span class="dv">42</span>, temperature<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 92 words</p>
</blockquote>
<p>Looking at numbers greater than 130:</p>
<ul>
<li>131: reads as <strong>1-3-1</strong> → This is the same forwards and backwards ✓</li>
</ul>
<p><strong>131</strong> is the smallest palindrome greater than 130.</p>
</div>
</div>
<div id="90e1be7d-970e-4964-a01b-b73de4cf6f28" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"Using only the provided tools to make no mistake, what is (11545468+78782431)*418742?"</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>tools <span class="op">=</span> Tools([add, multiply])</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>orclient(user_prompt<span class="op">=</span>prompt, tools<span class="op">=</span>tools, think<span class="op">=</span><span class="dv">2014</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 35 words</p>
</blockquote>
<p>I’ll solve this step by step using the provided tools.</p>
<p>First, let me add 11545468 and 78782431:</p>
<blockquote class="blockquote">
<p>[Tool call] … <code>add</code> returned <code>90327899</code></p>
</blockquote>
<p>Now let me multiply the result by 418742:</p>
<blockquote class="blockquote">
<p>[Tool call] … <code>multiply</code> returned <code>37824085083058</code></p>
</blockquote>
<p>The answer is <strong>37,824,085,083,058</strong>.</p>
</div>
</div>
<p><strong>Images</strong></p>
<div id="5955c708-b8af-47f4-91ba-1ccf0ef17c61" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="st">"openai/gpt-5.2"</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>orclient <span class="op">=</span> OpenRouterModelClient(model)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>openrouter: testing model openai/gpt-5.2 ... ok</code></pre>
</div>
</div>
<div id="d4066991-c00e-40f8-8b19-288aaa08e680" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"Describe this picture in a structured way"</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> Images(<span class="st">"puppy.jpg"</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>orclient(user_prompt<span class="op">=</span>prompt, user_images<span class="op">=</span>images)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="structured-description-of-the-image" class="level2 cell-output cell-output-display cell-output-markdown">
<h2 class="anchored" data-anchor-id="structured-description-of-the-image">Structured Description of the Image</h2>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">1) Overview</h3>
<ul>
<li><strong>Scene type:</strong> Outdoor animal portrait/action shot<br>
</li>
<li><strong>Main subject:</strong> A light-colored puppy (appears to be a golden retriever-type) running toward the camera<br>
</li>
<li><strong>Setting:</strong> Open grassy field with a softly blurred background</li>
</ul>
</section>
<section id="subject-details" class="level3">
<h3 class="anchored" data-anchor-id="subject-details">2) Subject Details</h3>
<ul>
<li><strong>Animal:</strong> Young dog/puppy<br>
</li>
<li><strong>Fur color &amp; texture:</strong> Cream to pale golden, fluffy coat<br>
</li>
<li><strong>Face:</strong> Dark eyes, black nose, mouth open with tongue visible (panting/happy expression)<br>
</li>
<li><strong>Ears:</strong> Floppy, slightly darker golden tone than the face<br>
</li>
<li><strong>Accessories:</strong> Thin collar/strap visible around the neck area</li>
</ul>
</section>
<section id="action-pose" class="level3">
<h3 class="anchored" data-anchor-id="action-pose">3) Action &amp; Pose</h3>
<ul>
<li><strong>Motion:</strong> Running forward toward the viewer<br>
</li>
<li><strong>Body position:</strong> Front paw lifted mid-step; posture suggests energetic movement<br>
</li>
<li><strong>Expression/emotion:</strong> Playful, cheerful, excited (open mouth “smile,” tongue out)</li>
</ul>
</section>
<section id="environment-background" class="level3">
<h3 class="anchored" data-anchor-id="environment-background">4) Environment / Background</h3>
<ul>
<li><strong>Foreground:</strong> Short grass with a few small stems/seedheads visible<br>
</li>
<li><strong>Background:</strong> Strong blur (shallow depth of field), suggesting distance and open space; colors imply a natural landscape (field/meadow)</li>
</ul>
</section>
<section id="composition-camera-perspective" class="level3">
<h3 class="anchored" data-anchor-id="composition-camera-perspective">5) Composition &amp; Camera Perspective</h3>
<ul>
<li><strong>Framing:</strong> Subject centered and dominant in the frame<br>
</li>
<li><strong>Angle:</strong> Low, near ground level, emphasizing the puppy’s approach<br>
</li>
<li><strong>Focus:</strong> Sharp focus on the puppy; background is heavily defocused (bokeh), drawing attention to the subject</li>
</ul>
</section>
<section id="lighting-color-palette" class="level3">
<h3 class="anchored" data-anchor-id="lighting-color-palette">6) Lighting &amp; Color Palette</h3>
<ul>
<li><strong>Lighting:</strong> Soft natural daylight, evenly illuminating the puppy<br>
</li>
<li><strong>Dominant colors:</strong> Cream/golden (puppy), green/yellow-brown (grass and background), muted neutral sky tones<br>
</li>
<li><strong>Overall tone:</strong> Warm and gentle, with a natural outdoor feel</li>
</ul>
</section>
<section id="mood-impression" class="level3">
<h3 class="anchored" data-anchor-id="mood-impression">7) Mood / Impression</h3>
<ul>
<li><strong>Mood:</strong> Joyful, lively, friendly<br>
</li>
<li><strong>Implied context:</strong> A puppy playing or running freely in a field</li>
</ul>
</section>
</section>
</div>
<div id="30771a54-51c0-4dd9-8af7-157498b26e81" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"Describe both images in a short paragraph"</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>images.add_web_url(<span class="st">"https://i.pinimg.com/736x/3c/fa/a2/3cfaa27aeff09adff6c2e6fbc5fd0dfa.jpg"</span>)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>orclient(user_prompt<span class="op">=</span>prompt, user_images<span class="op">=</span>images)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Both images feature a fluffy golden retriever puppy outdoors in a grassy field. In the first image, the puppy is running toward the camera with its mouth open and tongue out, looking playful and energetic against a softly blurred green background. In the second image, the puppy is sitting calmly in warm golden-hour light, gazing upward with a relaxed expression while the sun hangs low in an orange sky behind it.</p>
</div>
</div>
<p><strong>Structured outputs</strong></p>
<div id="ed719178-354e-470b-a707-d7b6ae1c995c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"I have two cats named Luna and Loki, Luna is 2 years old an yellow, Loki is 2 years older and the same color as the sky"</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>orclient(user_prompt<span class="op">=</span>prompt, output_model<span class="op">=</span>PetList)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>orclient.response</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 71 words</p>
</blockquote>
<p>{“pets”:[{“name”:“Luna”,“animal”:“cat”,“age”:2,“color”:“yellow”},{“name”:“Loki”,“animal”:“cat”,“age”:4,“color”:“blue”}]}</p>
</div>
<div class="cell-output cell-output-display">
<pre><code>PetList(pets=[Pet(name='Luna', animal='cat', age=2, color='yellow'), Pet(name='Loki', animal='cat', age=4, color='blue')])</code></pre>
</div>
</div>
<p><strong>Web search</strong></p>
<div id="6b861c2a-3ffd-4103-ac67-d35ac9b7c3ae" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"what are the features in the latest github relase of ollama"</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>orclient(user_prompt<span class="op">=</span>prompt, web_search<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<blockquote class="blockquote">
<p>[Thinking] … thought in 473 words</p>
</blockquote>
<p>As of <strong>January 10, 2026</strong>, the newest item on Ollama’s GitHub “Releases” page is <strong>v0.14.0-rc2 (pre-release)</strong>. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)</p>
<section id="v0.14.0-rc2-pre-release-main-new-features-changes" class="level2">
<h2 class="anchored" data-anchor-id="v0.14.0-rc2-pre-release-main-new-features-changes">v0.14.0-rc2 (pre-release) — main new features / changes</h2>
<ul>
<li><strong>New experimental CLI mode</strong>: <code>ollama run --experimental</code> adds a <em>new Ollama CLI</em> with an <strong>agent loop</strong> and a built-in <strong><code>bash</code> tool</strong>. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>Anthropic API compatibility</strong>: support for the <strong><code>/v1/messages</code></strong> API. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>Modelfile version gating</strong>: new <strong><code>REQUIRES</code></strong> command to declare the minimum Ollama version a model needs. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>Low-VRAM safety fix</strong>: avoids an <strong>integer underflow</strong> during memory estimation on low-VRAM systems (for older models). (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>Better AMD iGPU reporting</strong>: more accurate <strong>VRAM measurements</strong>. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>App improvement</strong>: highlights <strong>Swift source code</strong>. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>Embedding robustness</strong>: returns an error if embeddings contain <strong><code>NaN</code></strong> or <strong><code>-Inf</code></strong>. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>Linux installer packaging</strong>: bundles now use <strong>zst</strong> compression. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>Experimental image generation</strong>: adds experimental support for <strong>image generation models</strong>, powered by <strong>MLX</strong>. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)</li>
</ul>
</section>
<section id="if-you-meant-the-latest-stable-non-pre-release-release-v0.13.5" class="level2">
<h2 class="anchored" data-anchor-id="if-you-meant-the-latest-stable-non-pre-release-release-v0.13.5">If you meant the latest <em>stable</em> (non-pre-release) release: v0.13.5</h2>
<ul>
<li><strong>New model</strong>: Google’s <strong>FunctionGemma</strong> (Gemma 3 270M tuned for function calling). (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>Engine support</strong>: <strong><code>bert</code>-architecture</strong> models now run on Ollama’s engine. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>DeepSeek-V3.1 improvements</strong>: built-in <strong>renderer</strong> and <strong>tool parsing</strong>. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)<br>
</li>
<li><strong>Tool rendering fix</strong>: nested tool properties render correctly. (<a href="https://github.com/ollama/ollama/releases">github.com</a>)</li>
</ul>
<p>If you tell me whether you’re on <strong>macOS/Windows/Linux</strong> (and whether you want <strong>stable only</strong>), I can highlight which of these changes you’ll actually notice day-to-day.</p>
</section>
</div>
</div>
</section>
</section>
<section id="models-providers" class="level2">
<h2 class="anchored" data-anchor-id="models-providers">Models providers</h2>
<section id="design-concepts" class="level3">
<h3 class="anchored" data-anchor-id="design-concepts">Design concepts</h3>
<section id="user-centric-workflow" class="level4">
<h4 class="anchored" data-anchor-id="user-centric-workflow">User centric workflow</h4>
<ol type="1">
<li>identify your self-hosted inference or inference as a service options</li>
<li>understand your task type, properties, privacy needs and scale</li>
<li>find the best model for your task, given your constraints</li>
<li>prepare and start your self hosted inference or connect to your inference as a service provider</li>
<li>monitor your resource usage and cost</li>
</ol>
</section>
<section id="self-hosted-inference-or-inference-as-a-service" class="level4">
<h4 class="anchored" data-anchor-id="self-hosted-inference-or-inference-as-a-service">Self-hosted inference or inference as a service</h4>
<p>Model families - architecture name - parameter size - training type: base / instruct / thinking - version: relase date - quantization</p>
<p>Model constraints - model capabilities - modalities in/out - context length - instruction - thinking - tools - model usage - prompt template and special tokens - languages supported - recommended use cases - prompting guidelines - model license - use case restrictions - commercial usage restrictions - outputs usage restrictions - model transparency</p>
<p>Self-hosted inference constraints - model requirements - size on disk -&gt; download time / load time in vram - size in vram -&gt; max context length / num parallel sequence - tensor flops -&gt; input tokens/sec - memory bandwidth -&gt; output tokens/sec - inference machine constraints - download speed - disk size and speed - GPU vram, memory bandwidth, tensor flops - rented machine constraints - GPU availability - price when you use per GPU - price when you don’t use per GB (storage)</p>
<p>Inference as a service constraints - router constraints - … same as provider constraints below … - provider constraints - terms of service - privacy options - inference quotas - service availability - per model provider constraints - model capabilities exposed - input/output tokens cost - input/output tokens/sec</p>
</section>
</section>
<section id="list-download-and-load-models" class="level3">
<h3 class="anchored" data-anchor-id="list-download-and-load-models">List, download and load models</h3>
<section id="explore-ollama-api" class="level4">
<h4 class="anchored" data-anchor-id="explore-ollama-api">Explore ollama API</h4>
<p>Get ollama version</p>
<div id="143e8e1d-5041-4115-9e66-40757b9f1a7e" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>Request</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>curl http:<span class="op">//</span>localhost:<span class="dv">11434</span><span class="op">/</span>api<span class="op">/</span>version</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>Response</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"version"</span>: <span class="st">"0.5.1"</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>List remote models</p>
<p>As of december 2025, there is no API to get the ollama catalog of models, web scraping is the only solution.</p>
<div id="86e2ead5-6c44-4aae-8620-6119163bd102" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> httpx</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> html <span class="im">import</span> unescape</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> updated_to_months(updated):</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Convert strings like:</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="co">      "1 year ago", "2 years ago",</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="co">      "1 month ago", "3 weeks ago",</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="co">      "7 days ago", "yesterday",</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co">      "4 hours ago"</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="co">    into integer months.</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> updated:</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>    updated <span class="op">=</span> updated.lower().strip()</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># handle 'yesterday' explicitly</span></span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> updated <span class="op">==</span> <span class="st">"yesterday"</span>:</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># years → months</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> re.match(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="dv">\s</span><span class="op">+</span><span class="vs">year'</span>, updated)</span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> m:</span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>        years <span class="op">=</span> <span class="bu">int</span>(m.group(<span class="dv">1</span>))</span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> years <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># months</span></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> re.match(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="dv">\s</span><span class="op">+</span><span class="vs">month'</span>, updated)</span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> m:</span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">int</span>(m.group(<span class="dv">1</span>))</span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># weeks</span></span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> re.match(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="dv">\s</span><span class="op">+</span><span class="vs">week'</span>, updated)</span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> m:</span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a>        weeks <span class="op">=</span> <span class="bu">int</span>(m.group(<span class="dv">1</span>))</span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">0</span>, weeks <span class="op">//</span> <span class="dv">4</span>)</span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># days</span></span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> re.match(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\d</span><span class="op">+</span><span class="kw">)</span><span class="dv">\s</span><span class="op">+</span><span class="vs">day'</span>, updated)</span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> m:</span>
<span id="cb97-43"><a href="#cb97-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb97-44"><a href="#cb97-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-45"><a href="#cb97-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># hours / minutes / seconds → treat as &lt; 1 month</span></span>
<span id="cb97-46"><a href="#cb97-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(unit <span class="kw">in</span> updated <span class="cf">for</span> unit <span class="kw">in</span> [<span class="st">"hour"</span>, <span class="st">"minute"</span>, <span class="st">"second"</span>]):</span>
<span id="cb97-47"><a href="#cb97-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb97-48"><a href="#cb97-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-49"><a href="#cb97-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb97-50"><a href="#cb97-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-51"><a href="#cb97-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pulls_to_int(pulls_str):</span>
<span id="cb97-52"><a href="#cb97-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb97-53"><a href="#cb97-53" aria-hidden="true" tabindex="-1"></a><span class="co">    Convert a pulls string like:</span></span>
<span id="cb97-54"><a href="#cb97-54" aria-hidden="true" tabindex="-1"></a><span class="co">        '5M', '655.8K', '49K', '73.7M', '957.4K', '27.7M'</span></span>
<span id="cb97-55"><a href="#cb97-55" aria-hidden="true" tabindex="-1"></a><span class="co">    into an integer.</span></span>
<span id="cb97-56"><a href="#cb97-56" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb97-57"><a href="#cb97-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> pulls_str:</span>
<span id="cb97-58"><a href="#cb97-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb97-59"><a href="#cb97-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-60"><a href="#cb97-60" aria-hidden="true" tabindex="-1"></a>    pulls_str <span class="op">=</span> pulls_str.strip().upper()</span>
<span id="cb97-61"><a href="#cb97-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-62"><a href="#cb97-62" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> re.match(<span class="vs">r'</span><span class="kw">(</span><span class="pp">[</span><span class="dv">\d</span><span class="pp">,.]</span><span class="op">+</span><span class="kw">)</span><span class="dv">\s</span><span class="op">*</span><span class="kw">(</span><span class="pp">[KM]</span><span class="op">?</span><span class="kw">)</span><span class="vs">'</span>, pulls_str)</span>
<span id="cb97-63"><a href="#cb97-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> match:</span>
<span id="cb97-64"><a href="#cb97-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb97-65"><a href="#cb97-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-66"><a href="#cb97-66" aria-hidden="true" tabindex="-1"></a>    number, suffix <span class="op">=</span> match.groups()</span>
<span id="cb97-67"><a href="#cb97-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove commas and convert to float</span></span>
<span id="cb97-68"><a href="#cb97-68" aria-hidden="true" tabindex="-1"></a>    number <span class="op">=</span> <span class="bu">float</span>(number.replace(<span class="st">','</span>, <span class="st">''</span>))</span>
<span id="cb97-69"><a href="#cb97-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-70"><a href="#cb97-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> suffix <span class="op">==</span> <span class="st">'M'</span>:</span>
<span id="cb97-71"><a href="#cb97-71" aria-hidden="true" tabindex="-1"></a>        number <span class="op">*=</span> <span class="dv">1_000_000</span></span>
<span id="cb97-72"><a href="#cb97-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> suffix <span class="op">==</span> <span class="st">'K'</span>:</span>
<span id="cb97-73"><a href="#cb97-73" aria-hidden="true" tabindex="-1"></a>        number <span class="op">*=</span> <span class="dv">1_000</span></span>
<span id="cb97-74"><a href="#cb97-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-75"><a href="#cb97-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">int</span>(number)</span>
<span id="cb97-76"><a href="#cb97-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-77"><a href="#cb97-77" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_model_list_regex(html):</span>
<span id="cb97-78"><a href="#cb97-78" aria-hidden="true" tabindex="-1"></a>    models <span class="op">=</span> []</span>
<span id="cb97-79"><a href="#cb97-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-80"><a href="#cb97-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Extract each &lt;li x-test-model&gt;...&lt;/li&gt; block ---</span></span>
<span id="cb97-81"><a href="#cb97-81" aria-hidden="true" tabindex="-1"></a>    li_blocks <span class="op">=</span> re.findall(</span>
<span id="cb97-82"><a href="#cb97-82" aria-hidden="true" tabindex="-1"></a>        <span class="vs">r'&lt;li</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">x-test-model</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">&gt;</span><span class="kw">(</span><span class="dv">.</span><span class="op">*?</span><span class="kw">)</span><span class="vs">&lt;/li&gt;'</span>,</span>
<span id="cb97-83"><a href="#cb97-83" aria-hidden="true" tabindex="-1"></a>        html,</span>
<span id="cb97-84"><a href="#cb97-84" aria-hidden="true" tabindex="-1"></a>        flags<span class="op">=</span>re.DOTALL</span>
<span id="cb97-85"><a href="#cb97-85" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb97-86"><a href="#cb97-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-87"><a href="#cb97-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> block <span class="kw">in</span> li_blocks:</span>
<span id="cb97-88"><a href="#cb97-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-89"><a href="#cb97-89" aria-hidden="true" tabindex="-1"></a>        <span class="co"># name from &lt;a href="/library/..."&gt;</span></span>
<span id="cb97-90"><a href="#cb97-90" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> <span class="va">None</span></span>
<span id="cb97-91"><a href="#cb97-91" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> re.search(<span class="vs">r'href="/library/</span><span class="kw">(</span><span class="pp">[^"]</span><span class="op">+</span><span class="kw">)</span><span class="vs">"'</span>, block)</span>
<span id="cb97-92"><a href="#cb97-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> m:</span>
<span id="cb97-93"><a href="#cb97-93" aria-hidden="true" tabindex="-1"></a>            name <span class="op">=</span> m.group(<span class="dv">1</span>)</span>
<span id="cb97-94"><a href="#cb97-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-95"><a href="#cb97-95" aria-hidden="true" tabindex="-1"></a>        <span class="co"># description &lt;p class="max-w-lg ..."&gt;...&lt;/p&gt;</span></span>
<span id="cb97-96"><a href="#cb97-96" aria-hidden="true" tabindex="-1"></a>        description <span class="op">=</span> <span class="st">""</span></span>
<span id="cb97-97"><a href="#cb97-97" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> re.search(</span>
<span id="cb97-98"><a href="#cb97-98" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'&lt;p</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">text-neutral-800</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">&gt;</span><span class="kw">(</span><span class="dv">.</span><span class="op">*?</span><span class="kw">)</span><span class="vs">&lt;/p&gt;'</span>,</span>
<span id="cb97-99"><a href="#cb97-99" aria-hidden="true" tabindex="-1"></a>            block,</span>
<span id="cb97-100"><a href="#cb97-100" aria-hidden="true" tabindex="-1"></a>            flags<span class="op">=</span>re.DOTALL</span>
<span id="cb97-101"><a href="#cb97-101" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb97-102"><a href="#cb97-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> m:</span>
<span id="cb97-103"><a href="#cb97-103" aria-hidden="true" tabindex="-1"></a>            description <span class="op">=</span> re.sub(<span class="vs">r'&lt;</span><span class="dv">.</span><span class="op">*?</span><span class="vs">&gt;'</span>, <span class="st">''</span>, m.group(<span class="dv">1</span>)).strip()</span>
<span id="cb97-104"><a href="#cb97-104" aria-hidden="true" tabindex="-1"></a>            description <span class="op">=</span> unescape(description)</span>
<span id="cb97-105"><a href="#cb97-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-106"><a href="#cb97-106" aria-hidden="true" tabindex="-1"></a>        <span class="co"># capabilities (x-test-capability)</span></span>
<span id="cb97-107"><a href="#cb97-107" aria-hidden="true" tabindex="-1"></a>        capabilities <span class="op">=</span> re.findall(</span>
<span id="cb97-108"><a href="#cb97-108" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'&lt;span</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">x-test-capability</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">&gt;</span><span class="kw">(</span><span class="dv">.</span><span class="op">*?</span><span class="kw">)</span><span class="vs">&lt;/span&gt;'</span>,</span>
<span id="cb97-109"><a href="#cb97-109" aria-hidden="true" tabindex="-1"></a>            block,</span>
<span id="cb97-110"><a href="#cb97-110" aria-hidden="true" tabindex="-1"></a>            flags<span class="op">=</span>re.DOTALL</span>
<span id="cb97-111"><a href="#cb97-111" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb97-112"><a href="#cb97-112" aria-hidden="true" tabindex="-1"></a>        capabilities <span class="op">=</span> [c.strip() <span class="cf">for</span> c <span class="kw">in</span> capabilities]</span>
<span id="cb97-113"><a href="#cb97-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-114"><a href="#cb97-114" aria-hidden="true" tabindex="-1"></a>        <span class="co"># check for the special 'cloud' span </span></span>
<span id="cb97-115"><a href="#cb97-115" aria-hidden="true" tabindex="-1"></a>        cloud <span class="op">=</span> <span class="va">False</span></span>
<span id="cb97-116"><a href="#cb97-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(</span>
<span id="cb97-117"><a href="#cb97-117" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'&lt;span</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">&gt;cloud&lt;/span&gt;'</span>,</span>
<span id="cb97-118"><a href="#cb97-118" aria-hidden="true" tabindex="-1"></a>            block,</span>
<span id="cb97-119"><a href="#cb97-119" aria-hidden="true" tabindex="-1"></a>            flags<span class="op">=</span>re.DOTALL</span>
<span id="cb97-120"><a href="#cb97-120" aria-hidden="true" tabindex="-1"></a>        ):</span>
<span id="cb97-121"><a href="#cb97-121" aria-hidden="true" tabindex="-1"></a>            cloud <span class="op">=</span> <span class="va">True</span></span>
<span id="cb97-122"><a href="#cb97-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-123"><a href="#cb97-123" aria-hidden="true" tabindex="-1"></a>        <span class="co"># sizes (x-test-size)</span></span>
<span id="cb97-124"><a href="#cb97-124" aria-hidden="true" tabindex="-1"></a>        sizes <span class="op">=</span> re.findall(</span>
<span id="cb97-125"><a href="#cb97-125" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'&lt;span</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">x-test-size</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">&gt;</span><span class="kw">(</span><span class="dv">.</span><span class="op">*?</span><span class="kw">)</span><span class="vs">&lt;/span&gt;'</span>,</span>
<span id="cb97-126"><a href="#cb97-126" aria-hidden="true" tabindex="-1"></a>            block,</span>
<span id="cb97-127"><a href="#cb97-127" aria-hidden="true" tabindex="-1"></a>            flags<span class="op">=</span>re.DOTALL</span>
<span id="cb97-128"><a href="#cb97-128" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb97-129"><a href="#cb97-129" aria-hidden="true" tabindex="-1"></a>        sizes <span class="op">=</span> [s.strip() <span class="cf">for</span> s <span class="kw">in</span> sizes]</span>
<span id="cb97-130"><a href="#cb97-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-131"><a href="#cb97-131" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pulls &lt;span x-test-pull-count&gt;5M&lt;/span&gt;</span></span>
<span id="cb97-132"><a href="#cb97-132" aria-hidden="true" tabindex="-1"></a>        pulls <span class="op">=</span> <span class="va">None</span></span>
<span id="cb97-133"><a href="#cb97-133" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> re.search(</span>
<span id="cb97-134"><a href="#cb97-134" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'&lt;span</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">x-test-pull-count</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">&gt;</span><span class="kw">(</span><span class="dv">.</span><span class="op">*?</span><span class="kw">)</span><span class="vs">&lt;/span&gt;'</span>,</span>
<span id="cb97-135"><a href="#cb97-135" aria-hidden="true" tabindex="-1"></a>            block</span>
<span id="cb97-136"><a href="#cb97-136" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb97-137"><a href="#cb97-137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> m:</span>
<span id="cb97-138"><a href="#cb97-138" aria-hidden="true" tabindex="-1"></a>            pulls <span class="op">=</span> m.group(<span class="dv">1</span>).strip()</span>
<span id="cb97-139"><a href="#cb97-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-140"><a href="#cb97-140" aria-hidden="true" tabindex="-1"></a>        <span class="co"># tag count &lt;span x-test-tag-count&gt;5&lt;/span&gt;</span></span>
<span id="cb97-141"><a href="#cb97-141" aria-hidden="true" tabindex="-1"></a>        tag_count <span class="op">=</span> <span class="va">None</span></span>
<span id="cb97-142"><a href="#cb97-142" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> re.search(</span>
<span id="cb97-143"><a href="#cb97-143" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'&lt;span</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">x-test-tag-count</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">&gt;</span><span class="kw">(</span><span class="dv">.</span><span class="op">*?</span><span class="kw">)</span><span class="vs">&lt;/span&gt;'</span>,</span>
<span id="cb97-144"><a href="#cb97-144" aria-hidden="true" tabindex="-1"></a>            block</span>
<span id="cb97-145"><a href="#cb97-145" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb97-146"><a href="#cb97-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> m:</span>
<span id="cb97-147"><a href="#cb97-147" aria-hidden="true" tabindex="-1"></a>            tag_count <span class="op">=</span> m.group(<span class="dv">1</span>).strip()</span>
<span id="cb97-148"><a href="#cb97-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-149"><a href="#cb97-149" aria-hidden="true" tabindex="-1"></a>        <span class="co"># updated text &lt;span x-test-updated&gt;...&lt;/span&gt;</span></span>
<span id="cb97-150"><a href="#cb97-150" aria-hidden="true" tabindex="-1"></a>        updated <span class="op">=</span> <span class="va">None</span></span>
<span id="cb97-151"><a href="#cb97-151" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> re.search(</span>
<span id="cb97-152"><a href="#cb97-152" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'&lt;span</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">x-test-updated</span><span class="pp">[^&gt;]</span><span class="op">*</span><span class="vs">&gt;</span><span class="kw">(</span><span class="dv">.</span><span class="op">*?</span><span class="kw">)</span><span class="vs">&lt;/span&gt;'</span>,</span>
<span id="cb97-153"><a href="#cb97-153" aria-hidden="true" tabindex="-1"></a>            block</span>
<span id="cb97-154"><a href="#cb97-154" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb97-155"><a href="#cb97-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> m:</span>
<span id="cb97-156"><a href="#cb97-156" aria-hidden="true" tabindex="-1"></a>            updated <span class="op">=</span> m.group(<span class="dv">1</span>).strip()</span>
<span id="cb97-157"><a href="#cb97-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-158"><a href="#cb97-158" aria-hidden="true" tabindex="-1"></a>        models.append({</span>
<span id="cb97-159"><a href="#cb97-159" aria-hidden="true" tabindex="-1"></a>            <span class="st">"name"</span>: name,</span>
<span id="cb97-160"><a href="#cb97-160" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: description,</span>
<span id="cb97-161"><a href="#cb97-161" aria-hidden="true" tabindex="-1"></a>            <span class="st">"capabilities"</span>: capabilities,</span>
<span id="cb97-162"><a href="#cb97-162" aria-hidden="true" tabindex="-1"></a>            <span class="st">"cloud"</span>: cloud,</span>
<span id="cb97-163"><a href="#cb97-163" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sizes"</span>: sizes,</span>
<span id="cb97-164"><a href="#cb97-164" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pulls"</span>: pulls_to_int(pulls),</span>
<span id="cb97-165"><a href="#cb97-165" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tag_count"</span>: <span class="bu">int</span>(tag_count),</span>
<span id="cb97-166"><a href="#cb97-166" aria-hidden="true" tabindex="-1"></a>            <span class="st">"updated_months"</span>: updated_to_months(updated),</span>
<span id="cb97-167"><a href="#cb97-167" aria-hidden="true" tabindex="-1"></a>            <span class="st">"url"</span>: <span class="ss">f"https://ollama.com/library/</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> name <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb97-168"><a href="#cb97-168" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb97-169"><a href="#cb97-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-170"><a href="#cb97-170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> models   </span>
<span id="cb97-171"><a href="#cb97-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-172"><a href="#cb97-172" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_models(contains<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb97-173"><a href="#cb97-173" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb97-174"><a href="#cb97-174" aria-hidden="true" tabindex="-1"></a><span class="co">    Extract model names and properties from https://ollama.com/library</span></span>
<span id="cb97-175"><a href="#cb97-175" aria-hidden="true" tabindex="-1"></a><span class="co">    Optionally filter by substring.</span></span>
<span id="cb97-176"><a href="#cb97-176" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb97-177"><a href="#cb97-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-178"><a href="#cb97-178" aria-hidden="true" tabindex="-1"></a>    html <span class="op">=</span> httpx.get(<span class="st">"https://ollama.com/library"</span>).text</span>
<span id="cb97-179"><a href="#cb97-179" aria-hidden="true" tabindex="-1"></a>    models <span class="op">=</span> parse_model_list_regex(html)</span>
<span id="cb97-180"><a href="#cb97-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-181"><a href="#cb97-181" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> contains:</span>
<span id="cb97-182"><a href="#cb97-182" aria-hidden="true" tabindex="-1"></a>        models <span class="op">=</span> [</span>
<span id="cb97-183"><a href="#cb97-183" aria-hidden="true" tabindex="-1"></a>            m <span class="cf">for</span> m <span class="kw">in</span> models</span>
<span id="cb97-184"><a href="#cb97-184" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> contains.lower() <span class="kw">in</span> m[<span class="st">"name"</span>].lower()</span>
<span id="cb97-185"><a href="#cb97-185" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb97-186"><a href="#cb97-186" aria-hidden="true" tabindex="-1"></a>        models <span class="op">=</span> <span class="bu">sorted</span>(models, key<span class="op">=</span><span class="kw">lambda</span> m:m[<span class="st">"name"</span>])</span>
<span id="cb97-187"><a href="#cb97-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-188"><a href="#cb97-188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> models</span>
<span id="cb97-189"><a href="#cb97-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-190"><a href="#cb97-190" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_recent_models_from_family(familyfilter):</span>
<span id="cb97-191"><a href="#cb97-191" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="ss">f"</span><span class="sc">{</span>m[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>m[<span class="st">'capabilities'</span>] <span class="cf">if</span> <span class="bu">len</span>(m[<span class="st">'capabilities'</span>])<span class="op">&gt;</span><span class="dv">0</span> <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>m[<span class="st">'sizes'</span>] <span class="cf">if</span> <span class="bu">len</span>(m[<span class="st">'sizes'</span>])<span class="op">&gt;</span><span class="dv">0</span> <span class="cf">else</span> <span class="st">''</span><span class="sc">}{</span><span class="st">' [cloud]'</span> <span class="cf">if</span> m[<span class="st">'cloud'</span>] <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> m <span class="kw">in</span> list_models(familyfilter) <span class="cf">if</span> m[<span class="st">"updated_months"</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> m[<span class="st">"updated_months"</span>]<span class="op">&lt;</span><span class="dv">12</span>]</span>
<span id="cb97-192"><a href="#cb97-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-193"><a href="#cb97-193" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_tags(model):</span>
<span id="cb97-194"><a href="#cb97-194" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb97-195"><a href="#cb97-195" aria-hidden="true" tabindex="-1"></a><span class="co">    Extract valid quantized tags only, without HTML noise,</span></span>
<span id="cb97-196"><a href="#cb97-196" aria-hidden="true" tabindex="-1"></a><span class="co">    and apply the same exclusions as original greps.</span></span>
<span id="cb97-197"><a href="#cb97-197" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb97-198"><a href="#cb97-198" aria-hidden="true" tabindex="-1"></a>    html <span class="op">=</span> httpx.get(<span class="ss">f"https://ollama.com/library/</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">/tags"</span>).text</span>
<span id="cb97-199"><a href="#cb97-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-200"><a href="#cb97-200" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Capture ONLY the tag part after model:..., e.g. 3b-instruct-q4_K_M</span></span>
<span id="cb97-201"><a href="#cb97-201" aria-hidden="true" tabindex="-1"></a>    raw_tags <span class="op">=</span> re.findall(</span>
<span id="cb97-202"><a href="#cb97-202" aria-hidden="true" tabindex="-1"></a>        <span class="vs">rf'</span><span class="sc">{</span>re<span class="sc">.</span>escape(model)<span class="sc">}</span><span class="vs">:</span><span class="kw">(</span><span class="pp">[A-Za-z0-9._-]</span><span class="op">*</span><span class="vs">q</span><span class="pp">[A-Za-z0-9._-]</span><span class="op">*</span><span class="kw">)</span><span class="vs">'</span>,</span>
<span id="cb97-203"><a href="#cb97-203" aria-hidden="true" tabindex="-1"></a>        html</span>
<span id="cb97-204"><a href="#cb97-204" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb97-205"><a href="#cb97-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-206"><a href="#cb97-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Re-add full prefix model:&lt;tag&gt;</span></span>
<span id="cb97-207"><a href="#cb97-207" aria-hidden="true" tabindex="-1"></a>    tags <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> t <span class="kw">in</span> raw_tags]</span>
<span id="cb97-208"><a href="#cb97-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-209"><a href="#cb97-209" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exclude text|base|fp|q4_[01]|q5_[01]</span></span>
<span id="cb97-210"><a href="#cb97-210" aria-hidden="true" tabindex="-1"></a>    tags <span class="op">=</span> [</span>
<span id="cb97-211"><a href="#cb97-211" aria-hidden="true" tabindex="-1"></a>        t <span class="cf">for</span> t <span class="kw">in</span> tags</span>
<span id="cb97-212"><a href="#cb97-212" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> re.search(<span class="vs">r'</span><span class="kw">(</span><span class="vs">text</span><span class="cf">|</span><span class="vs">base</span><span class="cf">|</span><span class="vs">fp</span><span class="cf">|</span><span class="vs">q</span><span class="pp">[45]</span><span class="vs">_</span><span class="pp">[01]</span><span class="kw">)</span><span class="vs">'</span>, t)</span>
<span id="cb97-213"><a href="#cb97-213" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb97-214"><a href="#cb97-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-215"><a href="#cb97-215" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Deduplicate</span></span>
<span id="cb97-216"><a href="#cb97-216" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">set</span>(tags)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="392377be-d847-46b9-9658-430ee348aba7" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>list_models()[:<span class="dv">5</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>[{'name': 'gpt-oss',
  'description': 'OpenAI’s open-weight models designed for powerful reasoning, agentic tasks, and versatile developer use cases.',
  'capabilities': ['tools', 'thinking'],
  'cloud': True,
  'sizes': ['20b', '120b'],
  'pulls': 5000000,
  'tag_count': 5,
  'updated_months': 1,
  'url': 'https://ollama.com/library/gpt-oss'},
 {'name': 'qwen3-vl',
  'description': 'The most powerful vision-language model in the Qwen model family to date.',
  'capabilities': ['vision', 'tools'],
  'cloud': True,
  'sizes': ['2b', '4b', '8b', '30b', '32b', '235b'],
  'pulls': 656300,
  'tag_count': 59,
  'updated_months': 1,
  'url': 'https://ollama.com/library/qwen3-vl'},
 {'name': 'ministral-3',
  'description': 'The Ministral 3 family is designed for edge deployment, capable of running on a wide range of hardware.',
  'capabilities': ['vision', 'tools'],
  'cloud': True,
  'sizes': ['3b', '8b', '14b'],
  'pulls': 49100,
  'tag_count': 16,
  'updated_months': 0,
  'url': 'https://ollama.com/library/ministral-3'},
 {'name': 'deepseek-r1',
  'description': 'DeepSeek-R1 is a family of open reasoning models with performance approaching that of leading models, such as O3 and Gemini 2.5 Pro.',
  'capabilities': ['tools', 'thinking'],
  'cloud': False,
  'sizes': ['1.5b', '7b', '8b', '14b', '32b', '70b', '671b'],
  'pulls': 73700000,
  'tag_count': 35,
  'updated_months': 5,
  'url': 'https://ollama.com/library/deepseek-r1'},
 {'name': 'qwen3-coder',
  'description': "Alibaba's performant long context models for agentic and coding tasks.",
  'capabilities': ['tools'],
  'cloud': True,
  'sizes': ['30b', '480b'],
  'pulls': 958100,
  'tag_count': 10,
  'updated_months': 2,
  'url': 'https://ollama.com/library/qwen3-coder'}]</code></pre>
</div>
</div>
<div id="a513f8cf-0679-44c0-bdb4-4fca3aaf1a23" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"qwen"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["qwen2.5-coder ['tools'] ['0.5b', '1.5b', '3b', '7b', '14b', '32b']",
 "qwen2.5vl ['vision'] ['3b', '7b', '32b', '72b']",
 "qwen3 ['tools', 'thinking'] ['0.6b', '1.7b', '4b', '8b', '14b', '30b', '32b', '235b']",
 "qwen3-coder ['tools'] ['30b', '480b'] [cloud]",
 "qwen3-embedding ['embedding'] ['0.6b', '4b', '8b']",
 "qwen3-vl ['vision', 'tools'] ['2b', '4b', '8b', '30b', '32b', '235b'] [cloud]"]</code></pre>
</div>
</div>
<div id="1f04212a-ad4a-4811-a8f9-833dee73e09d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"gemma"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["embeddinggemma ['embedding'] ['300m']",
 "gemma3 ['vision'] ['270m', '1b', '4b', '12b', '27b'] [cloud]",
 "gemma3n  ['e2b', 'e4b']"]</code></pre>
</div>
</div>
<div id="de3cae3b-d873-468d-9d80-8058b785ab8b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"stral"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["devstral ['tools'] ['24b']",
 "magistral ['tools', 'thinking'] ['24b']",
 "ministral-3 ['vision', 'tools'] ['3b', '8b', '14b'] [cloud]",
 "mistral ['tools'] ['7b']",
 'mistral-large-3   [cloud]',
 "mistral-nemo ['tools'] ['12b']",
 "mistral-small ['tools'] ['22b', '24b']",
 "mistral-small3.1 ['vision', 'tools'] ['24b']",
 "mistral-small3.2 ['vision', 'tools'] ['24b']"]</code></pre>
</div>
</div>
<div id="45e33d36-4e00-4d8c-9ce1-d6a0c9eafa84" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"gpt"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["gpt-oss ['tools', 'thinking'] ['20b', '120b'] [cloud]",
 "gpt-oss-safeguard ['tools', 'thinking'] ['20b', '120b']"]</code></pre>
</div>
</div>
<div id="524e9f87-1b3d-4190-9f56-dfbcff10bf15" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"deepseek"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["deepseek-ocr ['vision'] ['3b']",
 "deepseek-r1 ['tools', 'thinking'] ['1.5b', '7b', '8b', '14b', '32b', '70b', '671b']",
 "deepseek-v3  ['671b']",
 "deepseek-v3.1 ['tools', 'thinking'] ['671b'] [cloud]"]</code></pre>
</div>
</div>
<div id="61e455be-b1ae-4e12-bc16-d72ea08ea494" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"glm"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>['glm-4.6   [cloud]']</code></pre>
</div>
</div>
<div id="76e6dd40-3fc6-4feb-b2a2-209865434abc" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"granite"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["granite-embedding ['embedding'] ['30m', '278m']",
 "granite3.1-dense ['tools'] ['2b', '8b']",
 "granite3.1-moe ['tools'] ['1b', '3b']",
 "granite3.2 ['tools'] ['2b', '8b']",
 "granite3.2-vision ['vision', 'tools'] ['2b']",
 "granite3.3 ['tools'] ['2b', '8b']",
 "granite4 ['tools'] ['350m', '1b', '3b']"]</code></pre>
</div>
</div>
<div id="a71f35d1-2ae8-4564-9f9c-17ca98e378f0" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"llama"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["llama3.2-vision ['vision'] ['11b', '90b']",
 "llama4 ['vision', 'tools'] ['16x17b', '128x17b']"]</code></pre>
</div>
</div>
<div id="ff7893a9-afa2-4fb1-bfd0-9b5936e5eea3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"phi"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["dolphin-mixtral  ['8x7b', '8x22b']",
 "dolphin3  ['8b']",
 "phi4  ['14b']",
 "phi4-mini ['tools'] ['3.8b']",
 "phi4-mini-reasoning  ['3.8b']",
 "phi4-reasoning  ['14b']"]</code></pre>
</div>
</div>
<div id="99bdadec-2b71-40a7-be49-31fcf9e7a227" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"hermes"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["hermes3 ['tools'] ['3b', '8b', '70b', '405b']",
 "nous-hermes2-mixtral  ['8x7b']"]</code></pre>
</div>
</div>
<div id="88de106f-16a6-49f8-bacb-fdae0515e3e6" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"olmo"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["olmo2  ['7b', '13b']"]</code></pre>
</div>
</div>
<div id="5ee669d8-b586-4e7b-aa37-cf65489fabcc" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>list_recent_models_from_family(<span class="st">"embed"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>["embeddinggemma ['embedding'] ['300m']",
 "granite-embedding ['embedding'] ['30m', '278m']",
 "qwen3-embedding ['embedding'] ['0.6b', '4b', '8b']"]</code></pre>
</div>
</div>
<div id="1c24bc81-f6d7-433e-b3a8-53e70f914442" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>list_tags(<span class="st">"ministral-3"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'ministral-3:14b-instruct-2512-q4_K_M',
 'ministral-3:14b-instruct-2512-q8_0',
 'ministral-3:3b-instruct-2512-q4_K_M',
 'ministral-3:3b-instruct-2512-q8_0',
 'ministral-3:8b-instruct-2512-q4_K_M',
 'ministral-3:8b-instruct-2512-q8_0'}</code></pre>
</div>
</div>
<div id="cfd1969b-2832-47f9-8569-add48c966f4b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>list_tags(<span class="st">"mistral-small3.2"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'mistral-small3.2:24b-instruct-2506-q4_K_M',
 'mistral-small3.2:24b-instruct-2506-q8_0'}</code></pre>
</div>
</div>
<div id="81100df9-ed00-4bd4-afd6-96c8ddf9f1d4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>list_tags(<span class="st">"qwen3-vl"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'qwen3-vl:235b-a22b-instruct-q4_K_M',
 'qwen3-vl:235b-a22b-instruct-q8_0',
 'qwen3-vl:235b-a22b-thinking-q4_K_M',
 'qwen3-vl:235b-a22b-thinking-q8_0',
 'qwen3-vl:2b-instruct-q4_K_M',
 'qwen3-vl:2b-instruct-q8_0',
 'qwen3-vl:2b-thinking-q4_K_M',
 'qwen3-vl:2b-thinking-q8_0',
 'qwen3-vl:30b-a3b-instruct-q4_K_M',
 'qwen3-vl:30b-a3b-instruct-q8_0',
 'qwen3-vl:30b-a3b-thinking-q4_K_M',
 'qwen3-vl:30b-a3b-thinking-q8_0',
 'qwen3-vl:32b-instruct-q4_K_M',
 'qwen3-vl:32b-instruct-q8_0',
 'qwen3-vl:32b-thinking-q4_K_M',
 'qwen3-vl:32b-thinking-q8_0',
 'qwen3-vl:4b-instruct-q4_K_M',
 'qwen3-vl:4b-instruct-q8_0',
 'qwen3-vl:4b-thinking-q4_K_M',
 'qwen3-vl:4b-thinking-q8_0',
 'qwen3-vl:8b-instruct-q4_K_M',
 'qwen3-vl:8b-instruct-q8_0',
 'qwen3-vl:8b-thinking-q4_K_M',
 'qwen3-vl:8b-thinking-q8_0'}</code></pre>
</div>
</div>
<p>https://github.com/ollama/ollama/blob/main/docs/api.md#list-local-models</p>
<p>ollama.list().models -&gt; list(ollama._types.ListResponse.Model)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb130"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="at">ollama._types.ListResponse.Model</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">model</span><span class="kw">:</span><span class="at"> str 'qwen3:4b'</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">modified_at</span><span class="kw">:</span><span class="at"> datetime.datetime datetime(2025, 11, 22, 18, 53, 11)</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">digest</span><span class="kw">:</span><span class="at"> str '359d7dd4bcdab3d86b87d73ac27966f4dbb9f5efdfcc75d34a8764a09474fae7'</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">size</span><span class="kw">:</span><span class="at"> pydantic.types.ByteSize 2497293931</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">details</span><span class="kw">:</span><span class="at"> ollama._types.ModelDetails</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">parent_model</span><span class="kw">:</span><span class="at"> str ''</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">format</span><span class="kw">:</span><span class="at"> str 'gguf'</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">family</span><span class="kw">:</span><span class="at"> str 'qwen3'</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">families</span><span class="kw">:</span><span class="at"> Sequence[str] ['qwen3']</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">parameter_size</span><span class="kw">:</span><span class="at"> str '4.0B'</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">quantization_level</span><span class="kw">:</span><span class="at"> str 'Q4_K_M'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="a1465604-236a-4e4d-b149-acd1e27d6721" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>ollama.<span class="bu">list</span>().models[<span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Model(model='qwen3:4b', modified_at=datetime.datetime(2025, 11, 22, 18, 53, 11, 586211, tzinfo=TzInfo(3600)), digest='359d7dd4bcdab3d86b87d73ac27966f4dbb9f5efdfcc75d34a8764a09474fae7', size=2497293931, details=ModelDetails(parent_model='', format='gguf', family='qwen3', families=['qwen3'], parameter_size='4.0B', quantization_level='Q4_K_M'))</code></pre>
</div>
</div>
<p>https://github.com/ollama/ollama/blob/main/docs/api.md#show-model-information</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb133"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="at">ollama._types.ShowResponse</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">modified_at</span><span class="kw">:</span><span class="at"> datetime.datetime datetime.datetime(2025, 11, 22, 18, 53, 11)</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">template</span><span class="kw">:</span><span class="at"> str '{{- $lastUserIdx := -1 -}}...\n{{- end }}'</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">modelfile</span><span class="kw">:</span><span class="at"> str '...'</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">license</span><span class="kw">:</span><span class="at"> str '...'</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">details</span><span class="kw">:</span><span class="at"> ollama._types.ModelDetails -&gt; see above</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">model_info</span><span class="kw">:</span><span class="at"> Mapping[str, Any]</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.architecture'</span><span class="kw">:</span><span class="at"> </span><span class="st">'qwen3'</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.basename'</span><span class="kw">:</span><span class="at"> </span><span class="st">'Qwen3'</span><span class="at"> </span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.file_type'</span><span class="kw">:</span><span class="at"> </span><span class="dv">15</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.finetune'</span><span class="kw">:</span><span class="at"> </span><span class="st">'Thinking'</span><span class="at"> </span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.license'</span><span class="kw">:</span><span class="at"> </span><span class="st">'apache-2.0'</span></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.license.link'</span><span class="kw">:</span><span class="at"> </span><span class="st">'https://huggingface.co/Qwen/Qwen3-4B-Thinking-2507/blob/main/LICENSE'</span></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.parameter_count'</span><span class="kw">:</span><span class="at"> </span><span class="dv">4022468096</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.quantization_version'</span><span class="kw">:</span><span class="at"> 2, </span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.size_label'</span><span class="kw">:</span><span class="at"> </span><span class="st">'4B'</span></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.tags'</span><span class="kw">:</span><span class="at"> None</span></span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.type'</span><span class="kw">:</span><span class="at"> </span><span class="st">'model'</span></span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'general.version'</span><span class="kw">:</span><span class="at"> </span><span class="st">'2507'</span></span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'qwen3.attention.head_count'</span><span class="kw">:</span><span class="at"> </span><span class="dv">32</span></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'qwen3.attention.head_count_kv'</span><span class="kw">:</span><span class="at"> </span><span class="dv">8</span></span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'qwen3.attention.key_length'</span><span class="kw">:</span><span class="at"> </span><span class="dv">128</span></span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'qwen3.attention.layer_norm_rms_epsilon'</span><span class="kw">:</span><span class="at"> </span><span class="fl">1e-06</span></span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'qwen3.attention.value_length'</span><span class="kw">:</span><span class="at"> </span><span class="dv">128</span></span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'qwen3.block_count'</span><span class="kw">:</span><span class="at"> </span><span class="dv">36</span></span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'qwen3.context_length'</span><span class="kw">:</span><span class="at"> </span><span class="dv">262144</span></span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'qwen3.embedding_length'</span><span class="kw">:</span><span class="at"> </span><span class="dv">2560</span></span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'qwen3.feed_forward_length'</span><span class="kw">:</span><span class="at"> </span><span class="dv">9728</span></span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'qwen3.rope.freq_base'</span><span class="kw">:</span><span class="at"> </span><span class="dv">5000000</span></span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'tokenizer.ggml.add_bos_token'</span><span class="kw">:</span><span class="at"> </span><span class="ch">False</span></span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'tokenizer.ggml.bos_token_id'</span><span class="kw">:</span><span class="at"> </span><span class="dv">151643</span></span>
<span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'tokenizer.ggml.eos_token_id'</span><span class="kw">:</span><span class="at"> </span><span class="dv">151645</span></span>
<span id="cb133-33"><a href="#cb133-33" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'tokenizer.ggml.merges'</span><span class="kw">:</span><span class="at"> None</span></span>
<span id="cb133-34"><a href="#cb133-34" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'tokenizer.ggml.model'</span><span class="kw">:</span><span class="at"> </span><span class="st">'gpt2'</span></span>
<span id="cb133-35"><a href="#cb133-35" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'tokenizer.ggml.padding_token_id'</span><span class="kw">:</span><span class="at"> </span><span class="dv">151643</span></span>
<span id="cb133-36"><a href="#cb133-36" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'tokenizer.ggml.pre'</span><span class="kw">:</span><span class="at"> </span><span class="st">'qwen2'</span></span>
<span id="cb133-37"><a href="#cb133-37" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'tokenizer.ggml.token_type'</span><span class="kw">:</span><span class="at"> None</span></span>
<span id="cb133-38"><a href="#cb133-38" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">-'tokenizer.ggml.tokens'</span><span class="kw">:</span><span class="at"> None</span></span>
<span id="cb133-39"><a href="#cb133-39" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">parameters</span><span class="kw">:</span><span class="at"> str 'top_p 0.95\n repeat_penalty 1\n stop "&lt;|im_start|&gt;"\n stop "&lt;|im_end|&gt;"\n temperature 0.6\ n top_k 20'</span></span>
<span id="cb133-40"><a href="#cb133-40" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">capabilities</span><span class="kw">:</span><span class="at"> List[str] ['completion', 'tools', 'thinking']</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="64c73dfb-fabd-4ee1-9fba-7a24b74cfdde" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>ollama.show(<span class="st">'gemma3:4b'</span>).capabilities, ollama.show(<span class="st">'gemma3:4b'</span>).modelinfo</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>(['completion', 'vision'],
 {'gemma3.attention.head_count': 8,
  'gemma3.attention.head_count_kv': 4,
  'gemma3.attention.key_length': 256,
  'gemma3.attention.sliding_window': 1024,
  'gemma3.attention.value_length': 256,
  'gemma3.block_count': 34,
  'gemma3.context_length': 131072,
  'gemma3.embedding_length': 2560,
  'gemma3.feed_forward_length': 10240,
  'gemma3.mm.tokens_per_image': 256,
  'gemma3.vision.attention.head_count': 16,
  'gemma3.vision.attention.layer_norm_epsilon': 1e-06,
  'gemma3.vision.block_count': 27,
  'gemma3.vision.embedding_length': 1152,
  'gemma3.vision.feed_forward_length': 4304,
  'gemma3.vision.image_size': 896,
  'gemma3.vision.num_channels': 3,
  'gemma3.vision.patch_size': 14,
  'general.architecture': 'gemma3',
  'general.file_type': 15,
  'general.parameter_count': 4299915632,
  'general.quantization_version': 2,
  'tokenizer.ggml.add_bos_token': True,
  'tokenizer.ggml.add_eos_token': False,
  'tokenizer.ggml.add_padding_token': False,
  'tokenizer.ggml.add_unknown_token': False,
  'tokenizer.ggml.bos_token_id': 2,
  'tokenizer.ggml.eos_token_id': 1,
  'tokenizer.ggml.merges': None,
  'tokenizer.ggml.model': 'llama',
  'tokenizer.ggml.padding_token_id': 0,
  'tokenizer.ggml.pre': 'default',
  'tokenizer.ggml.scores': None,
  'tokenizer.ggml.token_type': None,
  'tokenizer.ggml.tokens': None,
  'tokenizer.ggml.unknown_token_id': 3})</code></pre>
</div>
</div>
<div id="efffa6e8-2816-4c1c-a051-dc29b5bc477c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>ollama.pull??</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> ollama.pull(model: str, *, insecure: bool = <span style="font-weight:bold;color:rgb(0,135,0)">False</span>, stream: bool = <span style="font-weight:bold;color:rgb(0,135,0)">False</span>) -&gt; Union[ollama._types.ProgressResponse, collections.abc.Iterator[ollama._types.ProgressResponse]]
<span class="ansi-red-fg">Source:</span>   
  <span style="font-weight:bold;color:rgb(0,135,0)">def</span> pull(
    self,
    model: str,
    *,
    insecure: bool = <span style="font-weight:bold;color:rgb(0,135,0)">False</span>,
    stream: bool = <span style="font-weight:bold;color:rgb(0,135,0)">False</span>,
  ) -&gt; Union[ProgressResponse, Iterator[ProgressResponse]]:
    <span class="ansi-yellow-fg">"""</span>
<span class="ansi-yellow-fg">    Raises `ResponseError` if the request could not be fulfilled.</span>
<span class="ansi-yellow-fg">    Returns `ProgressResponse` if `stream` is `False`, otherwise returns a `ProgressResponse` generator.</span>
<span class="ansi-yellow-fg">    """</span>
    <span style="font-weight:bold;color:rgb(0,135,0)">return</span> self._request(
      ProgressResponse,
      <span class="ansi-yellow-fg">'POST'</span>,
      <span class="ansi-yellow-fg">'/api/pull'</span>,
      json=PullRequest(
        model=model,
        insecure=insecure,
        stream=stream,
      ).model_dump(exclude_none=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>),
      stream=stream,
    )
<span class="ansi-red-fg">File:</span>      /home/workspace/wordslab-notebooks-lib/.venv/lib/python3.12/site-packages/ollama/_client.py
<span class="ansi-red-fg">Type:</span>      method</pre>
</div>
</div>
</div>
<div id="333b8647-58f5-495f-add3-bc2309fcc3a5" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>ollama.delete??</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> ollama.delete(model: str) -&gt; ollama._types.StatusResponse
<span class="ansi-red-fg">Docstring:</span> &lt;no docstring&gt;
<span class="ansi-red-fg">Source:</span>   
  <span style="font-weight:bold;color:rgb(0,135,0)">def</span> delete(self, model: str) -&gt; StatusResponse:
    r = self._request_raw(
      <span class="ansi-yellow-fg">'DELETE'</span>,
      <span class="ansi-yellow-fg">'/api/delete'</span>,
      json=DeleteRequest(
        model=model,
      ).model_dump(exclude_none=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>),
    )
    <span style="font-weight:bold;color:rgb(0,135,0)">return</span> StatusResponse(
      status=<span class="ansi-yellow-fg">'success'</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> r.status_code == <span class="ansi-green-fg">200</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span> <span class="ansi-yellow-fg">'error'</span>,
    )
<span class="ansi-red-fg">File:</span>      /home/workspace/wordslab-notebooks-lib/.venv/lib/python3.12/site-packages/ollama/_client.py
<span class="ansi-red-fg">Type:</span>      method</pre>
</div>
</div>
</div>
<p><strong>Streaming responses</strong></p>
<p>Certain endpoints stream responses as JSON objects. Streaming can be disabled by providing {“stream”: false} for these endpoints.</p>
<p><strong>Structured outputs</strong></p>
<p>Structured outputs are supported by providing a JSON schema in the format parameter. The model will generate a response that matches the schema. See the structured outputs example below.</p>
<p><strong>JSON mode</strong></p>
<p>Enable JSON mode by setting the format parameter to json. This will structure the response as a valid JSON object.</p>
<p>https://github.com/ollama/ollama/blob/main/docs/api.md#generate-a-completion</p>
<p>Parameters - model: (required) the model name - prompt: the prompt to generate a response for - suffix: the text after the model response - images: (optional) a list of base64-encoded images (for multimodal models such as llava) - think: (for thinking models) should the model think before responding?</p>
<p>Advanced parameters (optional): - format: the format to return a response in. Format can be json or a JSON schema - options: additional model parameters listed in the documentation for the Modelfile such as temperature - system: system message to (overrides what is defined in the Modelfile) - template: the prompt template to use (overrides what is defined in the Modelfile) - stream: if false the response will be returned as a single response object, rather than a stream of objects - raw: if true no formatting will be applied to the prompt. You may choose to use the raw parameter if you are specifying a full templated prompt in your request to the API - keep_alive: controls how long the model will stay loaded into memory following the request (default: 5m)</p>
<p>Response</p>
<p>A stream of JSON objects is returned:</p>
<p>{ “model”: “llama3.2”, “created_at”: “2023-08-04T08:52:19.385406455-07:00”, “response”: “The”, “done”: false }</p>
<p>The final response in the stream also includes additional data about the generation: - total_duration: time spent generating the response - load_duration: time spent in nanoseconds loading the model - prompt_eval_count: number of tokens in the prompt - prompt_eval_duration: time spent in nanoseconds evaluating the prompt - eval_count: number of tokens in the response - eval_duration: time in nanoseconds spent generating the response - response: empty if the response was streamed, if not streamed, this will contain the full response</p>
<p>A response can be received in one reply when streaming is off.</p>
<p>To calculate how fast the response is generated in tokens per second (token/s), divide eval_count / eval_duration * 10^9.</p>
<p><strong>Images</strong></p>
<p>To submit images to multimodal models, provide a list of base64-encoded images:</p>
<ul>
<li>“images”: [“iVBORw0KGgoAAAANSUhEUgAAAG0AAABmCAYAAADBPx+VAAAACXBI…”]</li>
</ul>
<div id="76a9a4ff-fc63-44ef-97ae-26af7567da6a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>ollama.generate(model<span class="op">=</span><span class="st">'gemma3'</span>, prompt<span class="op">=</span><span class="st">'Why is the sky blue?'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="54fc66e5-9a58-4243-89c3-2ccdb710673e" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>ollama.chat(model<span class="op">=</span><span class="st">'gemma3'</span>, messages<span class="op">=</span>[{<span class="st">'role'</span>: <span class="st">'user'</span>, <span class="st">'content'</span>: <span class="st">'Why is the sky blue?'</span>}])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="2707163e-156d-4fe7-a57d-8b7f768e9c6a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>ollama.embed(model<span class="op">=</span><span class="st">'gemma3'</span>, <span class="bu">input</span><span class="op">=</span><span class="st">'The sky is blue because of rayleigh scattering'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="3e169690-b0c3-4e1d-82a8-c61027cfec73" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>ollama.embed(model<span class="op">=</span><span class="st">'gemma3'</span>, <span class="bu">input</span><span class="op">=</span>[<span class="st">'The sky is blue because of rayleigh scattering'</span>, <span class="st">'Grass is green because of chlorophyll'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="3f141425-512e-4596-a0f6-673a8fccd9cf" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>ollama.ps()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>ProcessResponse(models=[])</code></pre>
</div>
</div>
<div id="8e9c2574-6372-4969-9636-6e638ec7fcee" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>ollama.web_search??</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> ollama.web_search(query: str, max_results: int = <span class="ansi-green-fg">3</span>) -&gt; ollama._types.WebSearchResponse
<span class="ansi-red-fg">Source:</span>   
  <span style="font-weight:bold;color:rgb(0,135,0)">def</span> web_search(self, query: str, max_results: int = <span class="ansi-green-fg">3</span>) -&gt; WebSearchResponse:
    <span class="ansi-yellow-fg">"""</span>
<span class="ansi-yellow-fg">    Performs a web search</span>
<span class="ansi-yellow-fg">    Args:</span>
<span class="ansi-yellow-fg">      query: The query to search for</span>
<span class="ansi-yellow-fg">      max_results: The maximum number of results to return (default: 3)</span>
<span class="ansi-yellow-fg">    Returns:</span>
<span class="ansi-yellow-fg">      WebSearchResponse with the search results</span>
<span class="ansi-yellow-fg">    Raises:</span>
<span class="ansi-yellow-fg">      ValueError: If OLLAMA_API_KEY environment variable is not set</span>
<span class="ansi-yellow-fg">    """</span>
    <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(0,135,0)">not</span> self._client.headers.get(<span class="ansi-yellow-fg">'authorization'</span>, <span class="ansi-yellow-fg">''</span>).startswith(<span class="ansi-yellow-fg">'Bearer '</span>):
      <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> ValueError(<span class="ansi-yellow-fg">'Authorization header with Bearer token is required for web search'</span>)
    <span style="font-weight:bold;color:rgb(0,135,0)">return</span> self._request(
      WebSearchResponse,
      <span class="ansi-yellow-fg">'POST'</span>,
      <span class="ansi-yellow-fg">'https://ollama.com/api/web_search'</span>,
      json=WebSearchRequest(
        query=query,
        max_results=max_results,
      ).model_dump(exclude_none=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>),
    )
<span class="ansi-red-fg">File:</span>      /home/workspace/wordslab-notebooks-lib/.venv/lib/python3.12/site-packages/ollama/_client.py
<span class="ansi-red-fg">Type:</span>      method</pre>
</div>
</div>
</div>
<div id="a5753e78-cde5-4f6c-bb76-ffe6e7231170" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>ollama.web_fetch??</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> ollama.web_fetch(url: str) -&gt; ollama._types.WebFetchResponse
<span class="ansi-red-fg">Source:</span>   
  <span style="font-weight:bold;color:rgb(0,135,0)">def</span> web_fetch(self, url: str) -&gt; WebFetchResponse:
    <span class="ansi-yellow-fg">"""</span>
<span class="ansi-yellow-fg">    Fetches the content of a web page for the provided URL.</span>
<span class="ansi-yellow-fg">    Args:</span>
<span class="ansi-yellow-fg">      url: The URL to fetch</span>
<span class="ansi-yellow-fg">    Returns:</span>
<span class="ansi-yellow-fg">      WebFetchResponse with the fetched result</span>
<span class="ansi-yellow-fg">    """</span>
    <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(0,135,0)">not</span> self._client.headers.get(<span class="ansi-yellow-fg">'authorization'</span>, <span class="ansi-yellow-fg">''</span>).startswith(<span class="ansi-yellow-fg">'Bearer '</span>):
      <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> ValueError(<span class="ansi-yellow-fg">'Authorization header with Bearer token is required for web fetch'</span>)
    <span style="font-weight:bold;color:rgb(0,135,0)">return</span> self._request(
      WebFetchResponse,
      <span class="ansi-yellow-fg">'POST'</span>,
      <span class="ansi-yellow-fg">'https://ollama.com/api/web_fetch'</span>,
      json=WebFetchRequest(
        url=url,
      ).model_dump(exclude_none=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>),
    )
<span class="ansi-red-fg">File:</span>      /home/workspace/wordslab-notebooks-lib/.venv/lib/python3.12/site-packages/ollama/_client.py
<span class="ansi-red-fg">Type:</span>      method</pre>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/wordslab-org\.github\.io\/wordslab-notebooks-lib");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/wordslab-org/wordslab-notebooks-lib/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>